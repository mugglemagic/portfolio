import{_ as f,c as $s}from"../chunks/DCf4JqPx.js";import{f as g,a as h,i as is,c as Ys}from"../chunks/B-iva8rw.js";import"../chunks/D0ihxO46.js";import{n as w,s as t,m as b,c as s,b as n,p as Ks,t as rs,a as Js}from"../chunks/BNPA_p_8.js";import{a,s as Xs,e as Zs}from"../chunks/DmT9Q6NN.js";import{H as Qs}from"../chunks/XUMD-9Mr.js";import{s as os}from"../chunks/C8YSO-qe.js";import{S as sn}from"../chunks/QRiZD35W.js";const cs={ref:"FR-0000",title:"Why We're Writing This (And Why Now)",description:"Why we decided to rebuild our recruitment platform from scratch - and document every decision along the way.",author:"Mark Basford",date:"2025-01-15T00:00:00.000Z",tags:["architecture","accessibility","enterprise","ai-assisted-development"],series:"Architecting for Everything",part:1,word_count:1487,estimated_reading_time:"10 min",published:!0},{ref:Un,title:Vn,description:$n,author:Yn,date:Kn,tags:Jn,series:Xn,part:Zn,word_count:Qn,estimated_reading_time:st,published:nt}=cs;var nn=g("<p>In 2017, Scotland opened the Queensferry Crossing. Not because the Forth Road Bridge had failed - it hadn’t. The old bridge still stands, still carries traffic, still does the job it was designed for decades ago. But the demands had changed. The volume of traffic, the weight of modern vehicles, the expectations of what a crossing should handle - the original bridge couldn’t grow into that future. So they built a new one alongside it.</p> <p>We found ourselves thinking about that bridge quite a lot last year.</p> <h2>The System That Works</h2> <p>At Tribepad, we have a product that works. Customers use it daily. It’s reliable, it’s popular, and it does what recruitment software needs to do. We’re not writing this because we escaped from something broken.</p> <p>But if you’ve ever maintained software that evolved over a decade, you’ll recognise the pattern. Procedural PHP that grew into Laravel. Twig templates sitting next to Smarty, sitting next to React components, sitting next to Vue. Each layer made sense at the time. Each decision was reasonable given what we knew then.</p> <p>The system isn’t bad. It’s just… full. Every feature touches three different paradigms. Every change requires archaeology. Bespoke permissions and customer-specific branches that seemed manageable at ten clients become labyrinthine at a hundred. The velocity slows not because anyone made mistakes, but because the structure wasn’t built for this scale.</p> <p>And then there’s the thing nobody planned for: we weren’t building for a world where AI could help us write, review, and maintain code.</p> <h2>The Moment Everything Shifted</h2> <p>We’d been watching AI tooling evolve for years. Copilot suggesting autocomplete. ChatGPT explaining stack traces. Interesting, occasionally useful, not transformative.</p> <p>Then something changed. The suggestions got better. The context windows got larger. The tools started understanding not just syntax but intent. And we noticed a pattern during experiments: AI assistance was dramatically more effective on well-structured code.</p> <p>Not clever code. Not complex abstractions. Just code with clear boundaries. Consistent patterns. Explicit types. Separation of concerns that meant context could be gathered without reading everything.</p> <p>The messy corners of our legacy codebase? AI struggled. The cleaner modules? AI accelerated us noticeably.</p> <p>This wasn’t about “vibe coding” - letting AI generate features while developers nod along. That path leads somewhere unpleasant, probably a production incident at 3am with nobody understanding what the code actually does. This was about AI as a genuine tool for skilled developers. The kind of tool that multiplies velocity when you know exactly what you’re building.</p> <p>The realisation came gradually, over dog walks and too many coffees: if we structured things deliberately, AI could help us move faster. And if we were going to restructure anyway, why patch the old bridge? Why not build the crossing we actually needed?</p> <h2>Writing for Two Audiences</h2> <p>We made a decision early: this new architecture would be written for two audiences.</p> <p>The first audience is obvious - developers. Us, today. Future team members who’ll inherit this codebase. The patterns need to be learnable, the conventions consistent, the reasoning documented.</p> <p>The second audience is less obvious but equally important: AI assistants.</p> <p>Not because we think AI replaces developers. It doesn’t. But because AI that understands your codebase is dramatically more useful than AI that’s guessing. So we write detailed CLAUDE.md files. We enforce strict typing. We maintain clear module boundaries. We document not just what the code does, but why we chose this approach over alternatives.</p> <p>It sounds like overhead. In practice, it’s an investment that pays back constantly. The AI makes better suggestions. New developers onboard faster. The documentation that helps AI also helps humans. Turns out writing clearly for machines forces you to write clearly, full stop.</p> <h2>The Four Pillars</h2> <p>We kept encountering false trade-offs. Enterprise software that was accessible or fast. Maintainable or feature-rich. Scalable or developer-friendly. As if quality was a zero-sum game where you had to sacrifice something.</p> <p>We decided to reject the premise.</p> <p><strong>Performance</strong> - Not as an afterthought or an optimisation pass before release. Baked into the architecture. Lazy loading by default. Bundle splitting that happens automatically. The kind of speed that doesn’t require heroics because the structure makes slowness difficult.</p> <p><strong>Scalability</strong> - Not “we’ll cross that bridge when we come to it.” Built for multi-tenant enterprise from day one. Microservice-separable architecture even if we’re not splitting services yet. The ability to grow without rewriting, because we’ve done enough rewrites.</p> <p><strong>Accessibility</strong> - This one’s personal. I’ve spent time with people who rely on screen readers, who navigate with keyboards alone, who need high contrast or different colour palettes to use software at all. I’ve watched them struggle with websites that technically passed audits but were practically unusable.</p> <p>We build recruitment software. The point is helping people find jobs. If someone can’t complete an application because we couldn’t be bothered with proper focus management, that’s on us. That’s a person who didn’t get a fair shot because we were lazy. “Fairer, faster, better hiring” isn’t just the company tagline - it’s a constraint that shapes every component we build.</p> <p><strong>Maintainability</strong> - Code that teaches itself. Patterns so consistent that understanding one module means understanding them all. Tests that catch regressions before they ship. Documentation that stays current because it’s part of the development process, not an afterthought someone writes reluctantly before a release.</p> <p>Four pillars. Not four options where you pick two.</p> <h2>Why Document This Publicly</h2> <p>The architecture we’re building isn’t specific to recruitment software. The patterns - multizone micro-frontends, accessible component libraries, event-driven systems, multi-tenant theming - they’re applicable anywhere you’re building enterprise software that needs to scale.</p> <p>We learned from others who documented their decisions. Now it’s our turn.</p> <p>This blog series is partly for the developer community. Here’s what we tried, here’s what worked, here’s what we’d do differently. Take what’s useful, ignore what isn’t, improve on our approaches.</p> <p>It’s partly for our team. When someone joins six months from now and wonders why we structured authentication this way, the reasoning is documented. Not just what we built, but the trade-offs we considered and rejected.</p> <p>And it’s partly for anyone who cares how their software is built. Not every customer reads technical blogs. But for those who do, for those who want to know that the platform they’re trusting with their hiring actually considered accessibility and security and maintainability - here’s the evidence.</p> <h2>What’s Coming</h2> <p>This is the first post in an ongoing series. We’ll cover architecture decisions like why we split one application into five independent zones. Component library philosophy - building accessible primitives that don’t make you choose between delight and inclusion. The event system that decouples everything. How we structured code so AI assistants can genuinely help.</p> <p>Each post follows a simple pattern: here’s the problem, here’s what we considered, here’s what we built, here’s what we learned. No fluff, no self-congratulation, just reasoning you can evaluate and adapt.</p> <p>Some of it will be wrong. We’ll find better approaches. When we do, we’ll document those too. This isn’t a monument to our brilliance - it’s a journal of decisions made with the best information we had at the time.</p> <h2>The Bridge We’re Building</h2> <p>The Forth Road Bridge still works. It still carries traffic. Nobody demolished it when the Queensferry Crossing opened - they just redirected the demands it couldn’t handle.</p> <p>That’s roughly our situation. The legacy system continues. Customers depend on it. But alongside it, we’re building something that can handle what’s coming. Enterprise scale. AI-assisted development. Accessibility that isn’t an afterthought. The kind of architecture you’d design if you knew then what we know now.</p> <p>We’re writing this because we hope it helps someone. Maybe you’re facing the same decision - patch forever or build fresh. Maybe you’re wrestling with accessibility in a codebase that wasn’t designed for it. Maybe you’re wondering how to structure code so AI tooling actually helps rather than hallucinates.</p> <p>We don’t have all the answers. But we’ve got some decisions we’re confident about, some experiments that worked, and some failures that taught us things. Seems worth sharing.</p> <p>The dogs heard a lot about software architecture on our walks this year. Now it’s your turn.</p> <hr/> <h2>Technical Notes</h2> <p>This post is part of the “Architecting for Everything” series, documenting the frontend architecture decisions for a modern enterprise application.</p> <p><strong>Coming up:</strong></p> <ul><li>Multizone architecture and why we split into independent deployable zones</li> <li>Component library philosophy with React Aria primitives</li> <li>Accessibility patterns that don’t compromise on design</li> <li>Event-driven systems for decoupled, testable code</li> <li>AI-assisted development practices that actually work</li></ul> <p>All code and patterns discussed in this series are production implementations, not theoretical exercises.</p> <hr/> <h2>A Note on How This Was Written</h2> <p>In the spirit of transparency - and because it rather proves the point - this blog series was written with AI assistance. The ideas, experiences, and architectural decisions are mine. The writing style was sculpted through detailed guidelines to match how I’d explain things if I were better at putting words together. I’m an architect, not a writer, and keeping with the bridge analogy, AI helps bridge that gap.</p> <p>Every post has been checked for accuracy against the actual codebase and reviewed by a colleague before publishing. Nothing here is AI hallucination dressed up as expertise. But the fluency? The structure? That’s AI doing what we’ve been talking about: multiplying the output of someone who knows what they want to say but struggles with saying it.</p>",1);function tn(p){var e=nn();w(108),h(p,e)}const an=Object.freeze(Object.defineProperty({__proto__:null,default:tn,metadata:cs},Symbol.toStringTag,{value:"Module"})),ls={ref:"FR-0001",title:"The Multizone Gambit",description:"How we structured our Next.js monorepo with Turborepo zones for maximum scalability and team autonomy.",author:"Mark Basford",date:"2025-01-16T00:00:00.000Z",tags:["architecture","scalability","performance","maintainability","turborepo","nextjs"],series:"Architecting for Everything",part:2,word_count:1347,estimated_reading_time:"9 min",published:!0,research_sources:["0002-frontend-module-structure.md","turbo.json","pnpm-workspace.yaml","frontend.conf"]},{ref:tt,title:at,description:et,author:ot,date:pt,tags:it,series:rt,part:ct,word_count:lt,estimated_reading_time:ut,published:dt,research_sources:ht}=ls;var en=g('<p>Delta Air Lines doesn’t run one enormous airport. They run hubs - Atlanta, Detroit, Minneapolis, Salt Lake City. Each hub operates independently. Each has its own gates, its own ground crews, its own local operations. But they share the same booking system, the same baggage handling protocols, the same safety standards. A plane landing in Atlanta doesn’t need to know how Minneapolis handles de-icing. It just needs to know that when it gets there, the infrastructure will work the same way.</p> <p>We found ourselves thinking about hubs when we started architecting the frontend.</p> <h2>The Monolith Problem</h2> <p>The natural way to build a Next.js application is as a single application. One <code>app/</code> directory, one build process, one deployment. It’s simple, it works, and for many projects it’s exactly right.</p> <p>But we knew where this was heading. We’d seen it before.</p> <p>A single codebase means a single bundle. Every user downloads code for features they’ll never touch. The admin panel ships to candidates. The settings page ships to hiring managers who’ll never visit it. As the application grows, so does everything - build times, bundle sizes, the blast radius of any change.</p> <p>Then there’s the team scaling problem. We don’t have multiple teams today, but we’re building for a future where we might. And if that future arrives, we’d rather not spend six months untangling a monolith. We’ve done that migration before. It’s not fun.</p> <p>So we faced a choice: build the obvious way and refactor later, or pay a small upfront cost for architecture that scales.</p> <p>We chose the upfront cost.</p> <h2>The Realisation</h2> <p>We didn’t start with multizones. We started with a normal Next.js application and a reasonable plan. Then we hit internationalisation.</p> <p>Recruitment software has a lot of words. Job descriptions, application forms, email templates, UI labels - thousands of translatable strings that multiply with every language you support. Our legacy product taught us this scales poorly if you’re not careful.</p> <p>The plan was sensible: segment the translation files. Load only the segments needed for each area. The dashboard doesn’t need admin translations. The candidate portal doesn’t need recruiter strings. Fetch what you need, nothing more.</p> <p>We tried. Multiple i18n packages. Creative loading strategies. Hacks that technically worked but felt like we were fighting the framework.</p> <p>The problem was structural. Next.js, by design, bundles everything together. You can code-split components, but configuration and resources want to be unified. We couldn’t cleanly segment without either duplicating infrastructure or building increasingly baroque workarounds.</p> <p>The huh moment came somewhere around the third i18n library: we were trying to make one application behave like several. What if we just… made it several?</p> <h2>The Hub Architecture</h2> <p>We split the frontend into five independent Next.js applications - zones in Next.js terminology.</p> <pre class="language-undefined"><!></pre> <p>Each zone is a complete, independent Next.js application. Its own <code>package.json</code>, its own <code>next.config.ts</code>, its own build process. You can run dashboard without auth running. You can deploy admin without touching settings.</p> <p>Nginx handles routing. Requests to <code>/auth</code> go to the auth zone on port 3001. Requests to <code>/dashboard</code> go to port 3002. The main zone catches everything else. From the user’s perspective, it’s one seamless application. From the architecture’s perspective, it’s five independent hubs.</p> <pre class="language-nginx"><!></pre> <h2>Shared Infrastructure</h2> <p>Independent hubs only work if they share common infrastructure. Delta’s hubs work because they use the same booking system, not five incompatible ones.</p> <p>Our shared infrastructure lives in workspace packages:</p> <p><strong>@eos/ui</strong> - The component library. Buttons, inputs, layouts, the Themis accessible components. Every zone imports from the same source. Change a button once, every zone gets the update.</p> <p><strong>@eos/services</strong> - Business logic. API clients, authentication helpers, event handling, utilities. The spokes that connect each hub to the backend.</p> <p><strong>@eos/tsconfig</strong> - TypeScript configuration. The migration to multizones caused TypeScript friction - paths that worked in a monolith broke when we had five <code>tsconfig.json</code> files. So we created shared base configurations. Each zone extends the common defaults, adding only zone-specific overrides. Consistency without duplication.</p> <p>pnpm’s workspace protocol makes this seamless. Zones depend on <code>"@eos/ui": "workspace:*"</code> - always the current local version, no publishing, no version mismatches. Change a shared component, save the file, the zone hot-reloads with the update.</p> <h2>Event-Driven Consistency</h2> <p>Here’s a question: if zones are independent, how do they communicate?</p> <p>The short answer is they mostly don’t need to. Users aren’t running dashboard and admin simultaneously. Navigation between zones is a page load, not a state transfer.</p> <p>But there’s a subtler problem. The same events can originate from different places. A user updates their profile - that might happen from a form submission in the settings zone, or from a WebSocket push from the backend when an admin makes changes. Two sources, same logical event.</p> <p>Without coordination, you end up duplicating logic. The settings zone has its own handler for profile updates. The dashboard has another. When the WebSocket delivers the same event, you write a third handler that does the same thing differently.</p> <p>We use an event-driven pattern instead. Events are standardised across the application - <code>user.profile.updated</code> means the same thing regardless of where it originated. A zone publishes the event, subscribers react. A WebSocket delivers an event, the same subscribers react. One pattern, multiple sources, consistent behaviour.</p> <pre class="language-typescript"><!></pre> <p>This isn’t about zones talking to each other in real-time. It’s about maintaining consistency regardless of where events originate.</p> <h2>The Trade-offs</h2> <p>We’re not pretending this is free.</p> <p><strong>More configuration.</strong> Five <code>next.config.ts</code> files. Five <code>package.json</code> files. Nginx routing rules. Turborepo orchestration in <code>turbo.json</code>. There’s more surface area to understand.</p> <p><strong>Development setup.</strong> Five processes running, plus nginx. The first time you run <code>pnpm dev</code> and watch five zones spin up in parallel, it feels like a lot. (Turborepo handles this gracefully, but it’s still more than one process.)</p> <p><strong>Learning curve.</strong> Developers need to understand the zone boundaries. Where does this feature live? Which shared package should this utility go in? The decisions aren’t hard, but they’re decisions that don’t exist in a monolith.</p> <p>We accepted these trade-offs because the alternatives were worse. A monolith that becomes painful to change. Bundle sizes that grow unbounded. A future migration that takes months instead of never being necessary.</p> <h2>What We Gained</h2> <p>Each zone only bundles what it needs. Dashboard users don’t download admin code. The auth zone is tiny - just what’s required to get someone logged in.</p> <p>Turborepo caches aggressively. Change something in the dashboard zone, only dashboard rebuilds. The other four zones pull from cache. Incremental work stays incremental.</p> <p>Team boundaries are physical, not just conventional. You can’t accidentally import dashboard code into admin because they’re separate applications. The architecture enforces what code review would have to catch.</p> <p>And when - if - we ever need true microservices, the extraction path is clear. Each zone already deploys independently. Moving one to a separate repository would be a straightforward migration, not an archaeological expedition.</p> <h2>The Decision That Made Itself</h2> <p>We started with a practical problem: we couldn’t segment translations cleanly. The solution we found addressed problems we hadn’t even prioritised yet - bundle size, team scaling, deployment independence.</p> <p>Sometimes architecture decisions aren’t grand strategic choices. Sometimes you’re just trying to solve a specific problem, and the solution happens to unlock a better structure entirely.</p> <p>Five hubs, shared spokes, independent operations, common standards. It’s more complex than a monolith. It’s less complex than the monolith would have eventually become.</p> <p>The planes land at whichever hub they need. The infrastructure just works.</p> <hr/> <h2>Technical Notes</h2> <p><strong>Zone Locations:</strong> <code>apps/&#123;main,auth,dashboard,admin,settings&#125;/</code></p> <p><strong>Shared Packages:</strong> <code>packages/&#123;ui,services,tsconfig&#125;/</code></p> <p><strong>Key Configuration:</strong></p> <ul><li><code>turbo.json</code> - Task orchestration and caching</li> <li><code>pnpm-workspace.yaml</code> - Workspace and dependency catalog</li> <li><code>frontend.conf</code> - Nginx routing</li></ul> <p><strong>Related Posts:</strong></p> <ul><li>FR-0000: Why We’re Writing This (And Why Now)</li> <li>FR-0011: The Shared Package Strategy (coming soon)</li></ul> <p><strong>Stack:</strong> Next.js 16, Turborepo, pnpm workspaces, nginx</p> <hr/> <h2>A Note on How This Was Written</h2> <p>As with all posts in this series, this was written with AI assistance. The architectural decisions, the i18n problem that triggered the change, and the reasoning are mine. The clarity, hopefully, comes from the collaboration. Every technical claim has been verified against the actual codebase.</p>',1);function on(p){var e=en(),o=t(b(e),36),r=s(o);a(r,()=>`<code class="language-undefined">apps/
├── main/        # The landing pages, public content
├── auth/        # Login, registration, password reset
├── dashboard/   # The main recruiter workspace
├── admin/       # System administration
└── settings/    # User and tenant configuration</code>`),n(o);var i=t(o,6),l=s(i);a(l,()=>`<code class="language-nginx"><span class="token directive"><span class="token keyword">location</span> /auth</span> <span class="token punctuation">&#123;</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://frontend:3001</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token directive"><span class="token keyword">location</span> /dashboard</span> <span class="token punctuation">&#123;</span>
    <span class="token directive"><span class="token keyword">proxy_pass</span> http://frontend:3002</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment"># ... and so on</span></code>`),n(i);var c=t(i,28),m=s(c);a(m,()=>`<code class="language-typescript"><span class="token comment">// Settings zone updates profile</span>
eventBus<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'user.profile.updated'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> userId<span class="token punctuation">,</span> changes <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Dashboard subscribes once, handles all sources</span>
eventBus<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'user.profile.updated'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>payload<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">refreshUserData</span><span class="token punctuation">(</span>payload<span class="token punctuation">.</span>userId<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>`),n(c),w(58),h(p,e)}const pn=Object.freeze(Object.defineProperty({__proto__:null,default:on,metadata:ls},Symbol.toStringTag,{value:"Module"})),us={ref:"FR-0002",title:"Why React Aria Won",description:"Our journey evaluating component libraries and why React Aria's headless approach was the right choice for accessibility-first development.",author:"Mark Basford",date:"2025-01-17T00:00:00.000Z",tags:["architecture","accessibility","react-aria","components","performance"],series:"Architecting for Everything",part:3,word_count:1438,estimated_reading_time:"10 min",published:!0,research_sources:["0003-component-library-hybrid-approach.md","packages/ui/components/themis/","react-spectrum.adobe.com","ui.shadcn.com/docs/registry"]},{ref:kt,title:gt,description:mt,author:yt,date:bt,tags:ft,series:wt,part:vt,word_count:Tt,estimated_reading_time:At,published:xt,research_sources:_t}=us;var rn=g('<p>There’s an IKEA table called the Lack. Costs about fifteen quid, looks decent enough, fits in any room. Millions sold. What most people don’t realise until they try to move it is that the legs are hollow - cardboard honeycomb inside a thin veneer. It does the job right up until it doesn’t.</p> <p>We found ourselves thinking about that table quite a lot when evaluating component libraries.</p> <h2>The False Choice</h2> <p>Every component library we evaluated seemed to force a trade-off. Accessibility or style - pick one. Lightweight or feature-rich - pick one. Customisable or well-maintained - pick one.</p> <p>We’d been through this before with the legacy system. Layers of UI decisions made at different times, each reasonable in isolation, each creating friction with the others. jQuery plugins sitting next to React components sitting next to hand-rolled accessibility patches. The kind of situation where fixing one thing breaks three others.</p> <p>The new system needed foundations that wouldn’t crack under pressure. Not the cheapest option, not the flashiest - the one that would still be standing in five years.</p> <h2>The Research</h2> <p>This wasn’t a gut decision. We built evaluation matrices, weighted criteria, tested implementations. Weeks of work before writing a single production component.</p> <p>Our criteria, in order of importance:</p> <p><strong>Accessibility that’s architectural, not cosmetic.</strong> We needed WCAG 2.2 compliance baked into the primitives, not bolted on afterwards. There’s a future blog post about why this matters so deeply to us, but for now: we build recruitment software, and if someone can’t complete a job application because we were lazy about focus management, that’s on us.</p> <p><strong>Performance that doesn’t require heroics.</strong> Bundle size matters. Tree-shaking matters more. We didn’t want a library where keeping things fast required constant vigilance and import discipline.</p> <p><strong>Long-term sustainability.</strong> Who maintains this? What’s their incentive to keep maintaining it? Will this still exist and improve in 2027, or will we be migrating again?</p> <p><strong>Styling flexibility.</strong> We have our own design language. Whatever we chose needed to get out of the way and let us build what we actually wanted.</p> <h2>What We Evaluated</h2> <p>The landscape is crowded. Material UI, Chakra UI, Radix, Headless UI, various Tailwind component collections. Each with advocates, each with genuine strengths.</p> <p>Material UI is battle-tested - Netflix uses it, Amazon uses it. But 133KB gzipped is substantial, and Material Design’s aesthetic would require significant customisation to match our brand. More importantly, its CSS-in-JS approach would conflict with our Tailwind and Theme Provider architecture. We’d be running two parallel styling systems.</p> <p>Chakra UI v3 genuinely impressed us. The team did remarkable work on the rewrite - 50% bundle reduction, proper tree-shaking, accessibility that’s clearly a priority. For a while, it was our leading candidate.</p> <p>Radix and the various ShadCN implementations looked promising. Copy-paste ownership, Tailwind-native, active community. But professional accessibility audits we reviewed found issues that would require fixing. Why volunteer for extra work when other options handle it properly?</p> <p>The Tailwind-native libraries like Preline had the styling flexibility we wanted but accessibility gaps we couldn’t accept.</p> <h2>The Sustainability Question</h2> <p>Here’s where Chakra started to concern us.</p> <p>Chakra is maintained by talented people doing excellent work. But it’s a smaller team, and the jump from v2 to v3 - while impressive - also demonstrated how much can change between major versions. We’d seen this pattern before: promising library, great momentum, then the maintainers move on or priorities shift.</p> <p>React Aria is Adobe.</p> <p>That sounds like corporate allegiance, which isn’t quite the point. The point is incentive structure. Adobe uses React Aria to build their own products - Creative Cloud, Experience Cloud, the Spectrum design system that powers their enterprise software. They have a dedicated accessibility team testing these components. They’re not maintaining this as a side project; it’s infrastructure they depend on.</p> <p>When we looked at who would still be investing in accessibility improvements in five years, the answer seemed clearer.</p> <h2>The Headless Advantage</h2> <p>React Aria is headless. No styles, no opinions about how things should look - just behaviour. Keyboard navigation, focus management, screen reader announcements, touch handling, all the invisible complexity that makes components actually accessible.</p> <p>This initially seemed like more work. Other libraries give you styled components; React Aria gives you primitives that do nothing visual at all.</p> <p>But we started seeing it differently. The Lack table looks good because IKEA designed it to look good. You get their design, their compromises, their hollow legs. React Aria is more like buying quality oak and building your own table. More effort upfront, but you end up with exactly what you need, built to last.</p> <p>The headless architecture meant we could use our existing Tailwind setup, our Theme Provider, our design tokens. No fighting against someone else’s styling opinions. No parallel systems. Just behaviour primitives that handle the hard accessibility work while we handle the visual layer.</p> <h2>The ShadCN Insight</h2> <p>This is where things got interesting.</p> <p>ShadCN isn’t really a component library - it’s a philosophy and a registry pattern. Components you copy into your codebase, styled with Tailwind and CSS variables, following consistent conventions. No package to depend on, no version updates to manage. The code becomes yours.</p> <p>We’d seen JollyUI, which combines React Aria with ShadCN’s styling approach. It demonstrated the hybrid was viable - React Aria for the accessible behaviour, ShadCN’s patterns for the styling architecture. JollyUI deserves credit for proving the concept.</p> <p>But JollyUI is a personal project, and we needed something we could build on long-term. What we took from it was the pattern: React Aria as the behavioural foundation, ShadCN’s registry and styling conventions as the visual layer.</p> <p>The insight was that we didn’t need ShadCN’s components - we needed ShadCN’s approach. The registry pattern. The CSS variable integration. The way it plays nicely with design systems and, increasingly, with AI tooling that can understand consistent patterns.</p> <h2>The Hybrid Approach</h2> <p>So we built a hybrid.</p> <p>React Aria handles everything interactive. Buttons, dialogs, selects, menus, date pickers, form controls. Anywhere keyboard navigation matters, anywhere focus management matters, anywhere screen reader announcements matter - that’s React Aria territory.</p> <p>For components that don’t need that level of accessibility machinery - cards, badges, separators, purely visual elements - we build them ourselves following ShadCN’s styling patterns.</p> <p>The result is a component library where the complex stuff is handled by Adobe’s accessibility experts, and the simple stuff follows a consistent, repeatable pattern that integrates with our design system.</p> <p>Bundle impact: around 20-30KB gzipped for everything we use. Material UI’s baseline is 80-100KB before you’ve done anything.</p> <h2>What We Actually Got</h2> <p>Looking at where we are now:</p> <p>Components that are WCAG 2.2 accessible without us having to think about it. React Aria handles the edge cases - the mobile touch events, the right-to-left support, the screen reader announcements. We focus on making things look right and work well.</p> <p>A styling architecture that uses CSS custom properties consistently. Our Theme Provider controls everything. Light mode, dark mode, high contrast, colourblind-safe palettes - one system, no conflicts.</p> <p>A foundation that should scale. When React Aria improves - and it does, regularly - we get those improvements. When our design evolves, we update our styling layer without touching the accessibility machinery.</p> <p>And, perhaps most practically: a pattern that AI tools can understand. Consistent file structures, consistent prop patterns, consistent styling conventions. Claude Code actually helps us build components faster because the patterns are learnable.</p> <h2>The Table We’re Building</h2> <p>The Lack table works until you need to move it, or someone leans on it too hard, or you try to use it for something it wasn’t designed for. Then you discover the hollow legs.</p> <p>We’re not building IKEA furniture. We’re building something we’ll be maintaining and extending for years, something that needs to handle enterprise scale, something that has to work for everyone who uses it.</p> <p>React Aria gave us the oak. ShadCN showed us the joinery patterns. The table we’re building is ours - styled our way, structured our way, but standing on foundations that won’t collapse when we lean on them.</p> <p>Sometimes the right choice isn’t the quickest or the cheapest. Sometimes it’s the one that’s still working properly in five years.</p> <hr/> <h2>Technical Notes</h2> <p><strong>Component Library Location:</strong> <code>packages/ui/components/themis/</code></p> <p><strong>Key Dependencies:</strong></p> <ul><li><code>react-aria-components</code> - Accessible primitives</li> <li><code>class-variance-authority</code> - Variant styling (CVA)</li> <li>Tailwind CSS with CSS custom properties</li></ul> <p><strong>Related Posts:</strong></p> <ul><li>FR-0000: Why We’re Writing This (And Why Now)</li> <li>FR-0001: The Multizone Gambit</li> <li>FR-0003: The 44px Illusion (coming soon)</li> <li>FR-0012: Data Attributes Over React State (coming soon)</li></ul> <p><strong>References:</strong></p> <ul><li><a href="https://react-spectrum.adobe.com/react-aria/" rel="nofollow">React Aria Documentation</a></li> <li><a href="https://ui.shadcn.com/docs/registry" rel="nofollow">ShadCN Registry Pattern</a></li> <li><a href="https://www.jollyui.dev/" rel="nofollow">JollyUI</a> - Honourable mention for proving the hybrid approach</li></ul> <hr/> <h2>A Note on How This Was Written</h2> <p>As with all posts in this series, this was written with AI assistance. The evaluation process, the decision-making, and the reasoning are mine. The research took weeks; the writing took considerably less time with help. Every technical claim has been verified against our actual implementation.</p>',1);function cn(p){var e=rn();w(128),h(p,e)}const ln=Object.freeze(Object.defineProperty({__proto__:null,default:cn,metadata:us},Symbol.toStringTag,{value:"Module"})),ds={ref:"FR-0003",title:"The 44px Illusion",description:"Why WCAG's 44px touch target requirement is more nuanced than it seems, and how we built components that actually meet the intent.",author:"Mark Basford",date:"2025-01-18T00:00:00.000Z",tags:["accessibility","components","themis","wcag","touch-targets"],series:"Architecting for Everything",part:4,word_count:1467,estimated_reading_time:"10 min",published:!0,research_sources:["0003-component-library-hybrid-approach.md","switch-prd.md","packages/ui/components/themis/elements/Switch/Switch.tsx"]},{ref:St,title:It,description:Ct,author:Wt,date:Rt,tags:Bt,series:Lt,part:Et,word_count:Pt,estimated_reading_time:Dt,published:Nt,research_sources:Mt}=ds;var un=g('<p>In 1839, a French clockmaker named Jean-Eugène Robert-Houdin unveiled something that shouldn’t have been possible. A clock with transparent glass faces, no visible gears, no apparent mechanism - yet the hands moved precisely, as if by magic. The audience saw an elegant timepiece floating in space. What they couldn’t see was the second glass dial, positioned behind the visible one, connected by a hidden rod running through the ornate base. The invisible layer did all the work. The visible layer got all the attention.</p> <p>Robert-Houdin went on to become the father of modern stage magic, but his mystery clocks stayed with us. Not because we’re building clocks, but because we kept encountering the same problem he solved: how do you make something work properly without making it look like it’s working?</p> <h2>The Design Contradiction</h2> <p>WCAG 2.2 Success Criterion 2.5.5 recommends touch targets of at least 44 by 44 CSS pixels. This isn’t arbitrary - it’s the size that accommodates users with motor impairments, people using devices in unstable environments, anyone whose fingers aren’t perfectly precise. Apple and Google both recommend similar dimensions for their platforms.</p> <p>But designers, reasonably, want compact interfaces. A toggle switch that’s 44 pixels tall looks chunky. A small, sleek 20-pixel switch looks modern. The usual compromise forces a choice: accessible or stylish.</p> <p>Most solutions we evaluated accepted this trade-off. Either the component looked clunky to meet accessibility requirements, or it looked good but failed users who needed larger touch targets. Some libraries offered an “accessibility mode” - as if accessibility were an optional feature rather than a baseline requirement.</p> <p>We weren’t willing to accept that trade-off.</p> <h2>The Frustrating First Attempt</h2> <p>When building the Switch component for our Themis library, I started with the obvious approach. React Aria provides the accessible primitives - keyboard handling, focus management, ARIA attributes, screen reader announcements. We’d wrap that in our styling. Simple enough.</p> <p>The first implementation used two layers: the interactive switch track and the sliding thumb inside it. To meet the 44-pixel requirement, I made the track 44 pixels tall.</p> <p>It looked terrible. Genuinely clunky. The kind of toggle you’d expect from enterprise software that treats accessibility as a compliance checkbox rather than a design constraint. We could have shipped it - it would have passed every audit - but it wasn’t something we’d be proud of.</p> <p>I was frustrated, honestly. We’d chosen React Aria specifically because Adobe’s accessibility team handles the hard problems. But even React Aria’s own Select component only meets WCAG Level AA, not AAA. We’re trying to build a component library that aims higher. “Fairer, faster, better hiring” isn’t just a tagline - it’s a constraint that shapes every decision. If someone with motor impairments can’t complete a job application because we prioritised aesthetics over usability, that’s on us.</p> <p>Then I started thinking about Robert-Houdin’s clocks. The visible dial wasn’t the mechanism. The mechanism was invisible.</p> <h2>The Three-Layer Architecture</h2> <p>What if the touch target isn’t the visual element?</p> <p>The insight was simple once it arrived: separate the interactive layer from the visual layer entirely. The thing you tap doesn’t have to be the thing you see.</p> <p><strong>Layer 1: The Invisible Stage</strong></p> <p>The outermost layer is always 44 by 44 pixels minimum. It’s transparent. Sighted users don’t know it exists. But it’s the actual interactive element - the thing that receives clicks, taps, and focus.</p> <pre class="language-typescript"><!></pre> <p><strong>Layer 2: The Visual Track</strong></p> <p>Inside the invisible touch target sits the visual switch - the track that changes colour when toggled. This can be any size the design requires: 20 pixels for a compact switch, 24 for default, 28 for large. The visual size is independent of the touch target size.</p> <pre class="language-typescript"><!></pre> <p><strong>Layer 3: The Sliding Thumb</strong></p> <p>The innermost layer is the circular thumb that slides to indicate state. Pure visual feedback, no interaction handling.</p> <pre class="language-typescript"><!></pre> <p>The assembled component nests these layers:</p> <pre class="language-tsx"><!></pre> <p>Designers see a sleek 20-pixel switch. Users with motor impairments get a 44-pixel touch target. Same component, different experiences based on what each person needs.</p> <h2>Why 44 and Not 24?</h2> <p>WCAG 2.5.8 at Level AA requires only 24 pixels minimum. We could have met that standard with less effort.</p> <p>But AA is the floor, not the ceiling.</p> <p>We’re building recruitment software. The entire point is helping people find jobs. If we’re going to solve the accessibility problem, we should solve it properly - not scrape past the minimum requirement. Level AAA’s 44-pixel recommendation exists because it genuinely helps more people: those with motor impairments, users on bumpy commutes, anyone tapping quickly on mobile.</p> <p>Being mobile-first makes this practical as well as principled. Our users are recruiters reviewing applications between meetings, candidates applying from their phones. Larger touch targets aren’t just an accessibility feature - they’re better design for everyone using a touchscreen.</p> <h2>The Pattern Scales</h2> <p>The three-layer approach isn’t specific to switches. Any interactive element can use the same architecture:</p> <ul><li><strong>Buttons</strong>: The visible button can be any size; the touch target stays 44 pixels</li> <li><strong>Checkboxes</strong>: Small visual checkbox, full-size interactive area</li> <li><strong>Radio buttons</strong>: Same principle</li> <li><strong>Close buttons on dialogs</strong>: The tiny X icon sits inside a properly-sized touch target</li></ul> <p>Once you separate “what you see” from “what you touch,” the false choice between accessibility and aesthetics dissolves.</p> <h2>Testing the Illusion</h2> <p>The three-layer architecture creates an interesting testing situation. Visual regression tests verify the component looks right - the compact switch, the smooth animations, the theme integration. Accessibility tests verify the touch target is 44 pixels. Both pass because they’re testing different layers.</p> <pre class="language-typescript"><!></pre> <p>Screen readers interact with the outer layer and announce the switch properly. Sighted users interact with what appears to be the visual layer. Everyone gets what they need.</p> <h2>The Quiet Part</h2> <p>Passing the WCAG checklist is one thing. Whether someone can actually use the component is another question entirely. Audits check the specification; they don’t check the experience. A 44-pixel target that’s technically present but visually obscured still passes automated testing while failing real users.</p> <p>The three-layer pattern works because it treats accessibility as a design problem, not a compliance problem. The solution isn’t “make the switch bigger” - it’s “separate the concerns so each layer can do its job properly.”</p> <p>Robert-Houdin understood this. The visible clock face did its job: looking elegant. The hidden mechanism did its job: keeping time. Neither compromised for the other because they operated on different layers.</p> <h2>The Takeaway</h2> <p>Accessibility and aesthetics aren’t opposing forces. They’re different layers of the same component. When you stop trying to make one layer do both jobs, the conflict disappears.</p> <p>The small switch users see is real. The large touch target users touch is also real. They’re just not the same element - and they don’t need to be.</p> <p>Sometimes the best solution is the one nobody notices.</p> <hr/> <h2>Technical Notes</h2> <p><strong>Component Location:</strong> <code>packages/ui/components/themis/elements/Switch/</code></p> <p><strong>Key Dependencies:</strong></p> <ul><li><code>react-aria-components</code> - Accessible primitives (FR-0002)</li> <li><code>class-variance-authority</code> - Variant styling (CVA)</li> <li>Tailwind CSS with semantic tokens</li></ul> <p><strong>WCAG Compliance:</strong></p> <ul><li>Level AAA touch targets (44x44px minimum)</li> <li>7:1 contrast ratio in high-contrast theme</li> <li>Full keyboard navigation (Space, Enter to toggle)</li> <li>Screen reader announcements via React Aria</li></ul> <p><strong>Related Posts:</strong></p> <ul><li>FR-0002: Why React Aria Won</li> <li>FR-0004: The Compliance Trap (coming soon)</li> <li>FR-0012: Data Attributes Over React State (coming soon)</li></ul> <p><strong>References:</strong></p> <ul><li><a href="https://www.w3.org/WAI/WCAG22/Understanding/target-size-enhanced.html" rel="nofollow">WCAG 2.5.5 Target Size (Enhanced)</a></li> <li><a href="https://react-spectrum.adobe.com/react-aria/Switch.html" rel="nofollow">React Aria Switch</a></li></ul> <hr/> <h2>A Note on How This Was Written</h2> <p>As with all posts in this series, this was written with AI assistance. The frustration with the two-layer approach, the Robert-Houdin connection, and the architectural decisions are mine. The words came together faster with help. Every code example has been verified against the actual implementation.</p>',1);function dn(p){var e=un(),o=t(b(e),36),r=s(o);a(r,()=>`<code class="language-typescript"><span class="token keyword">const</span> switchOuterVariants <span class="token operator">=</span> <span class="token function">cva</span><span class="token punctuation">(</span>
  <span class="token string">"inline-flex shrink-0 cursor-pointer items-center justify-center min-h-[44px] min-w-[44px]"</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span> variants<span class="token operator">:</span> <span class="token punctuation">&#123;</span><span class="token punctuation">&#125;</span> <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code>`),n(o);var i=t(o,6),l=s(i);a(l,()=>`<code class="language-typescript"><span class="token keyword">const</span> switchTrackVariants <span class="token operator">=</span> <span class="token function">cva</span><span class="token punctuation">(</span>
  <span class="token string">"relative inline-flex shrink-0 items-center rounded-full border-2 transition-colors"</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    variants<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      size<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        sm<span class="token operator">:</span> <span class="token string">"h-5 w-9"</span><span class="token punctuation">,</span>      <span class="token comment">// 20x36px - looks compact</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">"h-6 w-11"</span><span class="token punctuation">,</span> <span class="token comment">// 24x44px - standard</span>
        lg<span class="token operator">:</span> <span class="token string">"h-7 w-14"</span><span class="token punctuation">,</span>      <span class="token comment">// 28x56px - large</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code>`),n(i);var c=t(i,6),m=s(c);a(m,()=>`<code class="language-typescript"><span class="token keyword">const</span> switchThumbVariants <span class="token operator">=</span> <span class="token function">cva</span><span class="token punctuation">(</span>
  <span class="token string">"pointer-events-none absolute rounded-full bg-background shadow-lg transition-transform"</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    variants<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      size<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        sm<span class="token operator">:</span> <span class="token string">"h-4 w-4"</span><span class="token punctuation">,</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">"h-5 w-5"</span><span class="token punctuation">,</span>
        lg<span class="token operator">:</span> <span class="token string">"h-6 w-6"</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code>`),n(c);var u=t(c,4),y=s(u);a(y,()=>`<code class="language-tsx"><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Switch</span></span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token function">switchOuterVariants</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token punctuation">&#123;</span><span class="token punctuation">(</span>renderProps<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token function">switchTrackVariants</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> size <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token punctuation">></span></span><span class="token plain-text">
      </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">className</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token function">switchThumbVariants</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> size <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
    </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Switch</span></span><span class="token punctuation">></span></span></code>`),n(u);var k=t(u,26),T=s(k);a(T,()=>`<code class="language-typescript"><span class="token comment">// Visual test: Switch looks compact</span>
<span class="token function">expect</span><span class="token punctuation">(</span>track<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveClass</span><span class="token punctuation">(</span><span class="token string">'h-5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span> <span class="token comment">// 20px visual height</span>

<span class="token comment">// Accessibility test: Touch target is adequate</span>
<span class="token function">expect</span><span class="token punctuation">(</span>outer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveStyle</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> minHeight<span class="token operator">:</span> <span class="token string">'44px'</span><span class="token punctuation">,</span> minWidth<span class="token operator">:</span> <span class="token string">'44px'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>`),n(k),w(46),h(p,e)}const hn=Object.freeze(Object.defineProperty({__proto__:null,default:dn,metadata:ds},Symbol.toStringTag,{value:"Module"})),hs={ref:"FR-0004",title:"The Compliance Trap",description:"Why passing automated accessibility tests doesn't mean your app is accessible, and what real accessibility testing looks like.",author:"Mark Basford",date:"2025-01-19T00:00:00.000Z",tags:["accessibility","testing","wcag","screen-readers","automation"],series:"Architecting for Everything",part:5,word_count:1498,estimated_reading_time:"10 min",published:!0,research_sources:["0003-component-library-hybrid-approach.md","Button.test.tsx","OTPInput.accessibility.test.tsx","eslint.config.js (jsx-a11y rules)","frontend-ci.yml"]},{ref:Ot,title:Ft,description:zt,author:jt,date:qt,tags:Gt,series:Ht,part:Ut,word_count:Vt,estimated_reading_time:$t,published:Yt,research_sources:Kt}=hs;var kn=g('<p>In 1824, a fifteen-year-old French student named Louis Braille invented a reading system for blind people. It was elegant, efficient, and - most importantly - it worked. Blind students at the Royal Institute for Blind Youth in Paris could finally read and write independently. The system spread. Other blind people learned it, taught it to each other, and for the first time had genuine literacy within reach.</p> <p>The sighted administrators hated it.</p> <p>Director Pierre-Armand Dufau banned the system, burned Braille books, and punished students caught using it. The official objection was that Braille didn’t resemble printed letters - sighted teachers couldn’t read it, which meant they couldn’t control it. A writing system designed specifically for blind people was rejected because it didn’t work for sighted people.</p> <p>Louis Braille died in 1852. France officially adopted his system two years later. The UK followed in 1870. The United States, after decades of infighting between competing tactile systems in what became known as the “War of the Dots,” didn’t adopt Braille until 1932 - eighty years after his death.</p> <p>We found ourselves thinking about Braille when reviewing our accessibility testing strategy. Not because anyone was burning books, but because we kept encountering the same underlying problem: systems designed to help disabled users, evaluated by people who don’t use assistive technology.</p> <h2>The Audit That Changed Everything</h2> <p>A few years ago, on a different product, we commissioned an accessibility review from the BBC. We’d done the work - or thought we had. Alt attributes on images. Labels on form inputs. ARIA labels where they seemed appropriate. The automated tools reported no critical violations. We were compliant.</p> <p>Then we watched actual users navigate the interface.</p> <p>One of the testers opened a feature I hadn’t known existed: the screen reader’s heading navigation menu. Most screen reader users don’t laboriously tab through every element on a page. They pull up a list of headings and jump directly to the section they need. It’s the equivalent of scanning a document visually - except it only works if the heading structure makes sense.</p> <p>Ours didn’t.</p> <p>We had <code>&lt;h1&gt;</code> tags, <code>&lt;h2&gt;</code> tags, even some <code>&lt;h3&gt;</code> tags. Each one had proper text content. An automated tool would check each heading in isolation and find nothing wrong. But the hierarchy was jumbled - an <code>&lt;h3&gt;</code> appearing before its parent <code>&lt;h2&gt;</code>, headings used for visual styling rather than document structure, landmarks missing entirely. The shortcut menu that should have provided quick navigation instead led users to the wrong places or missed sections altogether.</p> <p>Every individual element was compliant. The structure that made it usable was broken.</p> <p>As someone without disabilities, it’s hard to understand these problems unless you witness them firsthand. We’d tested with automated tools. We’d checked our ARIA attributes. We’d followed the guidelines. But we’d never actually watched someone who depends on assistive technology try to use what we’d built.</p> <h2>The Compliance Trap</h2> <p>A year or so later, I attended a presentation by Craig Abbott at Frontend North that put language to what we’d experienced. His core argument was simple and uncomfortable: WCAG compliance isn’t the same as accessibility.</p> <p>Automated tools check the specification. They verify that your button has an accessible name, that your images have alt text, that your form inputs have labels. These checks are valuable - they catch the obvious failures, the things you’d be embarrassed to ship. But they test attributes in isolation. They don’t navigate your page like a user would.</p> <p>axe-core can tell you that a button exists and has proper ARIA attributes. It cannot tell you that the button is visually obscured by a modal overlay that appeared after the audit ran. It cannot tell you that the heading structure makes navigation impossible. It cannot tell you that your focus management traps keyboard users in an inescapable loop.</p> <p>The trap is treating compliance as the destination rather than the starting point. Passing an automated audit feels like success. You get a green checkmark, maybe a badge for your footer. But the checkmark measures conformance to a specification, not usability for actual humans.</p> <h2>What Automated Testing Misses</h2> <p>After the BBC review, we started cataloguing the gaps:</p> <p><strong>Structural navigation.</strong> Screen readers provide shortcut menus for headings, landmarks, and form controls. If your heading hierarchy is illogical or landmarks are missing, these menus become useless. No automated tool checks whether your structure makes navigational sense.</p> <p><strong>Focus flow.</strong> Automated tests verify that an element is focusable. They cannot verify that focus moves logically, isn’t trapped in an invisible container, or returns sensibly after a modal closes.</p> <p><strong>Dynamic content.</strong> Most audits run against a static snapshot. They miss content that appears after interaction - dropdowns that announce incorrectly, error messages that appear visually but aren’t announced.</p> <p><strong>Obscured elements.</strong> A 44x44 pixel button is compliant. A 44x44 pixel button with 43 pixels hidden behind an overlay is technically compliant but practically unusable. Automated tools check properties, not reachability.</p> <h2>The Five Layers</h2> <p>We designed our testing strategy around a simple principle: different methods catch different problems. No single approach is sufficient.</p> <p><strong>Layer 1: Automated checks.</strong> axe-core in unit tests, jsx-a11y in ESLint, Lighthouse in CI. These catch baseline failures - missing alt text, invalid ARIA, contrast violations. Fast, consistent, and they catch the embarrassing mistakes. But they’re the floor, not the ceiling.</p> <p><strong>Layer 2: Interaction testing.</strong> We don’t just check that a button exists; we check that clicking it does something. If a button can’t receive a click event, the test fails regardless of what the DOM attributes say.</p> <pre class="language-typescript"><!></pre> <p><strong>Layer 3: Visual regression and element reachability.</strong> Screenshots capture what users actually see. But we go further with a technique that doesn’t get talked about enough: <code>elementFromPoint</code> testing.</p> <pre class="language-typescript"><!></pre> <p>This verifies that clicking the centre of a button actually hits the button - not a transparent overlay, not a modal backdrop that appeared after render. The DOM says the button exists. <code>elementFromPoint</code> tells you whether a user can reach it.</p> <p><strong>Layer 4: Real device testing.</strong> Before release, we test with actual screen readers - VoiceOver, NVDA, JAWS. Keyboard-only navigation. Zoom to 200% and 400%. Mobile touch and gestures. Automated tools can’t replicate hearing your interface announced aloud.</p> <p><strong>Layer 5: User testing.</strong> Nothing replaces actual users with disabilities. This isn’t a nice-to-have - it’s a gate before we ship. We’re building recruitment software. If someone can’t complete a job application because we optimised for audit scores instead of usability, we’ve failed at the fundamental purpose of what we’re building.</p> <p>We’ve implemented layers one through three in our codebase. Layers four and five are committed to before any public release, and we intend to share the results.</p> <h2>The Braille Lesson</h2> <p>Louis Braille’s system was rejected for decades because the people evaluating it weren’t the people who needed it. Sighted administrators judged a blind reading system by whether sighted people could read it. The evaluation criteria missed the point entirely.</p> <p>We do something similar when we judge accessibility by automated audit scores. The tools are built by sighted developers, run by sighted developers, and produce reports that sighted developers can understand. They measure what’s easy to measure, not necessarily what matters.</p> <p>The BBC review taught us that compliance is necessary but not sufficient. Craig Abbott’s presentation gave us the framework to articulate why. The gap between “passes automated testing” and “actually usable” is where real accessibility work happens.</p> <p>Braille was always the right system. It just needed to be evaluated by the people it was designed for.</p> <hr/> <h2>Technical Notes</h2> <p><strong>Testing Infrastructure:</strong></p> <ul><li>axe-core via <code>jest-axe</code>, ESLint jsx-a11y, Playwright visual regression</li> <li>Interaction testing via <code>@testing-library/user-event</code></li> <li><code>elementFromPoint</code> reachability tests (coming to Playwright suite)</li></ul> <p><strong>Related Posts:</strong></p> <ul><li>FR-0003: The 44px Illusion</li> <li>FR-0021: Testing in Three Dimensions (coming soon)</li></ul> <p><strong>References:</strong></p> <ul><li><a href="https://www.craigabbott.co.uk/" rel="nofollow">Craig Abbott</a> - Accessibility specialist whose work influenced our testing philosophy</li> <li><a href="https://www.w3.org/WAI/WCAG22/Understanding/" rel="nofollow">WCAG 2.2 Understanding Documents</a></li></ul> <hr/> <h2>A Note on How This Was Written</h2> <p>As with all posts in this series, this was written with AI assistance. The BBC review experience, the lessons from Craig Abbott’s presentation, and the testing philosophy are mine. The words came together faster with help. Every technical claim has been verified against our actual implementation.</p>',1);function gn(p){var e=kn(),o=t(b(e),56),r=s(o);a(r,()=>`<code class="language-typescript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'button receives click events'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> onPress <span class="token operator">=</span> vi<span class="token punctuation">.</span><span class="token function">fn</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Button onPress<span class="token operator">=</span><span class="token punctuation">&#123;</span>onPress<span class="token punctuation">&#125;</span><span class="token operator">></span>Submit<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> userEvent<span class="token punctuation">.</span><span class="token function">click</span><span class="token punctuation">(</span>screen<span class="token punctuation">.</span><span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>onPress<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveBeenCalled</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>`),n(o);var i=t(o,4),l=s(i);a(l,()=>`<code class="language-typescript"><span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'button is not obscured by other elements'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> page <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> button <span class="token operator">=</span> page<span class="token punctuation">.</span><span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">,</span> <span class="token punctuation">&#123;</span> name<span class="token operator">:</span> <span class="token string">'Submit'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> box <span class="token operator">=</span> <span class="token keyword">await</span> button<span class="token punctuation">.</span><span class="token function">boundingBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Check that the element at the button's center is the button itself</span>
  <span class="token keyword">const</span> elementAtCenter <span class="token operator">=</span> <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">evaluateHandle</span><span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> x<span class="token punctuation">,</span> y <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> document<span class="token punctuation">.</span><span class="token function">elementFromPoint</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#123;</span> x<span class="token operator">:</span> box<span class="token punctuation">.</span>x <span class="token operator">+</span> box<span class="token punctuation">.</span>width <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">,</span> y<span class="token operator">:</span> box<span class="token punctuation">.</span>y <span class="token operator">+</span> box<span class="token punctuation">.</span>height <span class="token operator">/</span> <span class="token number">2</span> <span class="token punctuation">&#125;</span>
  <span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span>elementAtCenter<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toEqual</span><span class="token punctuation">(</span><span class="token keyword">await</span> button<span class="token punctuation">.</span><span class="token function">elementHandle</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>`),n(i),w(40),h(p,e)}const mn=Object.freeze(Object.defineProperty({__proto__:null,default:gn,metadata:hs},Symbol.toStringTag,{value:"Module"})),ks={ref:"FR-0005",title:"The Server-Side Shield",description:"How we designed our security architecture with server-side JWT validation, CSRF protection, and why we never trust the client.",author:"Mark Basford",date:"2025-01-20T00:00:00.000Z",tags:["security","architecture","authentication","csrf","jwt","server-actions"],series:"Architecting for Everything",part:6,word_count:1482,estimated_reading_time:"10 min",published:!0,research_sources:["SECURITY_ARCHITECTURE.md","packages/services/lib/axios.ts","packages/services/lib/env.ts","packages/services/modules/user/server/lib/SessionJWT.ts","packages/services/modules/user/server/apis/"]},{ref:Jt,title:Xt,description:Zt,author:Qt,date:sa,tags:na,series:ta,part:aa,word_count:ea,estimated_reading_time:oa,published:pa,research_sources:ia}=ks;var yn=g(`<p>In the 1940s, American banks faced a problem: how do you let customers transact without letting them anywhere near the vault? Their solution was the pneumatic tube - a pressurised cylinder that whooshed capsules between the customer window and the teller’s station. The interaction felt almost playful. What customers didn’t see: reinforced tubing, one-way valves, the physical impossibility of reaching through to the other side. The friendly whoosh masked a deliberate architectural boundary.</p> <p>The technology spread to department stores, hospitals, and eventually some British banks in the 1960s. Most have been replaced now. But the principle endures.</p> <p>We found ourselves thinking about pneumatic tubes when designing how our frontend talks to the backend.</p> <h2>The Invisible Attack Surface</h2> <p>In May 2024, security researchers reverse-engineering the Rabbit R1 AI device discovered something that should have been impossible to find: API keys hardcoded directly into the client-side code. Not just any keys - the ElevenLabs key had full administrative privileges. With that single exposed credential, attackers could access the complete history of every text-to-speech message ever generated by any R1 device.</p> <p>The keys had been sitting there, in code that shipped to every customer, for months.</p> <p>This wasn’t a sophisticated attack. Someone looked at the client bundle and found secrets that should never have left the server. The Rabbit team presumably knew better. Most developers know better. And yet IBM’s research shows that breaches involving stolen credentials take an average of 292 days to detect - longer than any other attack vector. The secrets leak quietly. The damage accumulates invisibly.</p> <p>We didn’t want to learn this lesson firsthand.</p> <h2>The Principle</h2> <p>The architecture is simple to state: the browser never talks directly to the backend API. Every request goes through the server.</p> <pre class="language-undefined"><!></pre> <p>Not browser to backend. Not client-side fetch calls with API keys tucked into environment variables. The browser talks to our Next.js server, which talks to the backend. The browser never sees the backend URL, never handles authentication tokens directly, never has access to secrets that could be extracted from a bundle.</p> <p>The pneumatic tube, not the open window.</p> <h2>Server Actions as the Boundary</h2> <p>Next.js Server Actions give us a clean way to enforce this boundary. Any function marked with <code>'use server'</code> runs exclusively on the Node.js server - it physically cannot execute in the browser.</p> <pre class="language-typescript"><!></pre> <p>That <code>'use server'</code> directive isn’t a suggestion. The bundler strips these functions from client code entirely. They exist only on the server. The credentials go in, the response comes out, but the actual HTTP call to the backend happens in a context the browser cannot inspect.</p> <p>Every authentication function in our codebase follows this pattern. Login, signup, OTP validation, session management - all server actions. The browser submits form data; the server handles the sensitive operations.</p> <h2>CSRF Protection</h2> <p>Server-side API calls solve the secret exposure problem, but they don’t prevent cross-site request forgery. If a malicious site can trick a user’s browser into submitting a form to our server, the server would dutifully forward that request to the backend.</p> <p>We use Laravel Sanctum’s CSRF protection, integrated through axios interceptors:</p> <pre class="language-typescript"><!></pre> <p>The flow: when the application loads, we fetch a CSRF token from the backend. That token lives in a cookie. Every subsequent request includes the token in a header. The backend validates that the header matches the cookie - something a cross-site attacker cannot forge because they can’t read our cookies.</p> <p>The axios instance itself is created server-side. The interceptor runs server-side. The cookie reading happens server-side. The browser never touches the CSRF machinery directly.</p> <h2>Environment Isolation</h2> <p>Here’s where the pneumatic tube metaphor becomes concrete. Consider a typical environment configuration:</p> <pre class="language-typescript"><!></pre> <p>The <code>NEXT_PUBLIC_</code> prefix is the boundary. Variables without that prefix exist only in the server runtime. They’re not bundled, not shipped to browsers, not inspectable in DevTools. The signing secret, the API endpoint, the cookie name - none of it leaves the server.</p> <p>If someone decompiles our client bundle, they’ll find nothing useful. The secrets are on the other side of the tube.</p> <h2>JWT Session Management</h2> <p>When a user authenticates successfully, we generate a session token. This happens entirely server-side:</p> <pre class="language-typescript"><!></pre> <p>The JWT is signed with a secret the browser never sees. It’s stored in an <code>httpOnly</code> cookie the browser cannot read via JavaScript. The <code>sameSite: 'lax'</code> flag prevents the cookie from being sent on cross-site requests. The <code>secure</code> flag ensures HTTPS-only transmission in production.</p> <p>Four layers of protection, none of which require the browser to be trusted.</p> <h2>Events as a Security Layer</h2> <p>There’s one more boundary worth mentioning. Our forms don’t call server actions directly - they publish events.</p> <pre class="language-typescript"><!></pre> <p>The client expresses intent. The server decides what to do with it. The client never knows the API structure, the endpoint URLs, or the response handling logic. It publishes an event and waits for a result.</p> <p>This decoupling has security benefits beyond obscurity. Every event is validated against a schema. Every event is logged for audit trails. The event system becomes a checkpoint where we can add rate limiting, validation, or security monitoring without touching the UI code.</p> <p>We’ll explore the event architecture more deeply in a future post. For now, the relevant point is that it adds another layer to the shield.</p> <h2>What We Prevent</h2> <table><thead><tr><th>Threat</th><th>Mitigation</th></tr></thead><tbody><tr><td>Secret exposure in bundles</td><td>Server-side only, no <code>NEXT_PUBLIC_</code> prefix</td></tr><tr><td>CSRF attacks</td><td>XSRF-TOKEN + SameSite cookies</td></tr><tr><td>XSS token theft</td><td>HttpOnly cookies, server-side JWT</td></tr><tr><td>API structure exposure</td><td>Event-driven indirection</td></tr><tr><td>Session hijacking</td><td>HTTPS-only, short TTL, secure cookies</td></tr><tr><td>Credential interception</td><td>Server-to-server communication</td></tr></tbody></table> <p>None of these mitigations are novel. They’re well-documented security practices. The architecture just ensures they’re applied consistently, by default, without requiring every developer to remember the rules.</p> <h2>The Tube, Not the Window</h2> <p>The pneumatic tube worked because you physically cannot reach through it. The capsule goes in, the capsule comes out, but the mechanism - the pressure, the valves, the routing - happens in a space you cannot access.</p> <p>Our server-side architecture works the same way. The browser sends requests, receives responses, but never touches the machinery that processes them. The secrets stay on the server. The API calls happen server-to-server. The authentication tokens live in cookies the browser cannot read.</p> <p>It’s not clever. It’s not innovative. It’s just a boundary, consistently enforced, that prevents an entire category of vulnerabilities from being possible in the first place.</p> <p>Sometimes the best security is the attack surface that doesn’t exist.</p> <hr/> <h2>Technical Notes</h2> <p><strong>Patterns Used:</strong></p> <ul><li>Next.js Server Actions (<code>'use server'</code> directive)</li> <li>CSRF protection via Sanctum integration</li> <li>JWT signing with jose library</li> <li>HttpOnly + SameSite + Secure cookies</li> <li>Event-driven form handling</li></ul> <p><strong>Related Posts:</strong></p> <ul><li>FR-0001: The Multizone Gambit</li> <li>FR-0014: Seven Ways to Deliver an Event (coming soon)</li></ul> <p><strong>References:</strong></p> <ul><li><a href="https://rabbitu.de/articles/security-disclosure-1" rel="nofollow">Rabbit R1 Security Disclosure</a></li> <li><a href="https://www.ibm.com/security/data-breach" rel="nofollow">IBM Cost of a Data Breach Report 2024</a></li> <li><a href="https://owasp.org/API-Security/" rel="nofollow">OWASP API Security Top 10</a></li></ul> <hr/> <h2>A Note on How This Was Written</h2> <p>As with all posts in this series, this was written with AI assistance. The architectural decisions and security patterns are real implementations in our codebase. The Rabbit R1 incident informed our thinking before we wrote a line of authentication code - learning from others’ mistakes being preferable to making our own. Every code example is representative of the patterns we use.</p>`,1);function bn(p){var e=yn(),o=t(b(e),20),r=s(o);a(r,()=>'<code class="language-undefined">Browser → Next.js Server → Backend API</code>'),n(o);var i=t(o,10),l=s(i);a(l,()=>`<code class="language-typescript"><span class="token string">'use server'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">authenticate</span><span class="token punctuation">(</span>credentials<span class="token operator">:</span> Credentials<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> http <span class="token operator">=</span> <span class="token function">createSecureClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> response <span class="token operator">=</span> <span class="token keyword">await</span> http<span class="token punctuation">.</span><span class="token function">post</span><span class="token punctuation">(</span><span class="token string">'/auth/login'</span><span class="token punctuation">,</span> credentials<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">return</span> response<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code>`),n(i);var c=t(i,12),m=s(c);a(m,()=>`<code class="language-typescript"><span class="token string">'use server'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">function</span> <span class="token function">createSecureClient</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> cookieStore <span class="token operator">=</span> <span class="token function">cookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> client <span class="token operator">=</span> axios<span class="token punctuation">.</span><span class="token function">create</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
    withCredentials<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    withXSRFToken<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  client<span class="token punctuation">.</span>interceptors<span class="token punctuation">.</span>request<span class="token punctuation">.</span><span class="token function">use</span><span class="token punctuation">(</span><span class="token punctuation">(</span>config<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token keyword">const</span> token <span class="token operator">=</span> cookieStore<span class="token punctuation">.</span><span class="token function">get</span><span class="token punctuation">(</span><span class="token string">'XSRF-TOKEN'</span><span class="token punctuation">)</span><span class="token operator">?.</span>value<span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>token<span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      config<span class="token punctuation">.</span>headers<span class="token punctuation">[</span><span class="token string">'X-XSRF-TOKEN'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token function">decodeURIComponent</span><span class="token punctuation">(</span>token<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span>
    <span class="token keyword">return</span> config<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">return</span> client<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code>`),n(c);var u=t(c,10),y=s(u);a(y,()=>`<code class="language-typescript"><span class="token keyword">export</span> <span class="token keyword">const</span> config <span class="token operator">=</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">// Server-side only - never exposed to browser</span>
  signingSecret<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">SIGNING_SECRET</span><span class="token punctuation">,</span>
  apiEndpoint<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">API_ENDPOINT</span><span class="token punctuation">,</span>
  cookieName<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">COOKIE_NAME</span><span class="token punctuation">,</span>

  <span class="token comment">// Public - explicitly prefixed, safe to expose</span>
  appTitle<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NEXT_PUBLIC_APP_TITLE</span><span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code>`),n(u);var k=t(u,10),T=s(k);a(T,()=>`<code class="language-typescript"><span class="token string">'use server'</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token keyword">async</span> <span class="token keyword">function</span> <span class="token function">createSession</span><span class="token punctuation">(</span>
  user<span class="token operator">:</span> UserData<span class="token punctuation">,</span>
  expiresAt<span class="token operator">:</span> Date
<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Promise</span><span class="token operator">&lt;</span><span class="token keyword">void</span><span class="token operator">></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> cookieStore <span class="token operator">=</span> <span class="token function">cookies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> token <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token keyword">new</span> <span class="token class-name">SignJWT</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> user <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setProtectedHeader</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> alg<span class="token operator">:</span> <span class="token string">'HS256'</span> <span class="token punctuation">&#125;</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">setExpirationTime</span><span class="token punctuation">(</span>Math<span class="token punctuation">.</span><span class="token function">floor</span><span class="token punctuation">(</span>expiresAt<span class="token punctuation">.</span><span class="token function">getTime</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">/</span> <span class="token number">1000</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token function">sign</span><span class="token punctuation">(</span><span class="token keyword">new</span> <span class="token class-name">TextEncoder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>config<span class="token punctuation">.</span>signingSecret<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  cookieStore<span class="token punctuation">.</span><span class="token function">set</span><span class="token punctuation">(</span><span class="token string">'session'</span><span class="token punctuation">,</span> token<span class="token punctuation">,</span> <span class="token punctuation">&#123;</span>
    httpOnly<span class="token operator">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
    secure<span class="token operator">:</span> process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">===</span> <span class="token string">'production'</span><span class="token punctuation">,</span>
    sameSite<span class="token operator">:</span> <span class="token string">'lax'</span><span class="token punctuation">,</span>
    path<span class="token operator">:</span> <span class="token string">'/'</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code>`),n(k);var v=t(k,10),I=s(v);a(I,()=>`<code class="language-typescript"><span class="token comment">// Client component publishes intent</span>
<span class="token keyword">const</span> <span class="token function-variable function">handleSubmit</span> <span class="token operator">=</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>values<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">await</span> events<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'auth.login.requested'</span><span class="token punctuation">,</span> values<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">;</span>

<span class="token comment">// Server-side handler subscribes and executes</span>
events<span class="token punctuation">.</span><span class="token function">subscribe</span><span class="token punctuation">(</span><span class="token string">'auth.login.requested'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span>data<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> result <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">authenticate</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> events<span class="token punctuation">.</span><span class="token function">publish</span><span class="token punctuation">(</span><span class="token string">'auth.login.completed'</span><span class="token punctuation">,</span> result<span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>`),n(v),w(44),h(p,e)}const fn=Object.freeze(Object.defineProperty({__proto__:null,default:bn,metadata:ks},Symbol.toStringTag,{value:"Module"})),gs={ref:"FR-0006",title:"The Observability Iceberg",description:"Building full-stack observability with OpenTelemetry - from browser spans to backend traces, and everything in between.",author:"Mark Basford",date:"2025-01-21T00:00:00.000Z",tags:["observability","telemetry","opentelemetry","tracing","performance","debugging"],series:"Architecting for Everything",part:7,word_count:1467,estimated_reading_time:"10 min",published:!0,research_sources:["TELEMETRY_GUIDE.md","BROWSER_TELEMETRY_GUIDE.md","packages/ui/providers/TelemetryProvider/","services/modules/telemetry/"]},{ref:ra,title:ca,description:la,author:ua,date:da,tags:ha,series:ka,part:ga,word_count:ma,estimated_reading_time:ya,published:ba,research_sources:fa}=gs;var wn=g('<p>On August 1st, 2012, Knight Capital deployed new trading software to their production servers. Within forty-five minutes, they’d lost $440 million. The company was effectively bankrupt by lunchtime.</p> <p>The cause was almost mundane: old code accidentally reactivated during deployment. A function that hadn’t run in years suddenly started executing, making bizarre trades at machine speed. Knight Capital had monitoring. They had alerts. What they didn’t have was any way to correlate the behaviour - to see the flow of orders through their system and understand <em>why</em> the numbers were going wrong.</p> <p>By the time humans pieced together what was happening, it was over. Distributed tracing showing the journey of each order would have made the anomaly obvious within minutes. Instead, engineers were staring at dashboards full of red indicators, trying to manually reconstruct a story the system should have been telling them.</p> <p>We think about Knight Capital more than we probably should.</p> <h2>The 10% Problem</h2> <p>Here’s the uncomfortable truth about traditional logging: you’re seeing maybe 10% of what you need to understand a problem. An error message tells you something broke. It doesn’t tell you why, or what happened in the fifteen steps before the break, or whether those steps took milliseconds or minutes, or which user action triggered the whole chain.</p> <p>Logs are snapshots. Production issues are movies.</p> <p>We’ve lived this in legacy systems. An error appears in the logs. We know it happened. We know roughly when. But replicating it? Understanding the state that led to it? That’s where hours disappear. Someone starts adding temporary logging statements. Someone else tries to reproduce the issue locally. A third person is cross-referencing timestamps across different log files, building a mental model of what <em>might</em> have occurred.</p> <p>Meanwhile, users are still hitting the problem. And we’re still guessing.</p> <p>The development team loses half a day on something that proper tracing would have revealed in five minutes. Multiply that across a year, across every hard-to-reproduce bug, every “works on my machine” investigation, every cross-team finger-pointing session about whether the frontend or backend caused the issue. The cost isn’t dramatic like Knight Capital. It’s the slow erosion of velocity, the accumulated friction of debugging blind.</p> <h2>Tracing the Journey</h2> <p>The principle that changed our approach: the journey matters, not just the destination.</p> <p>When a user clicks “Sign Up” and something fails, the error message is the destination. But the journey - form submission, validation, API call, database write, response handling - that’s where the actual problem lives. Tracing captures the journey.</p> <pre class="language-undefined"><!></pre> <p>One trace ID. The complete story. Every step timed, every handoff recorded, every service connected. When that signup fails, we don’t ask “what happened?” We look at trace <code>abc123</code> and <em>see</em> what happened.</p> <p>The backend team doesn’t need to defend themselves. The frontend team doesn’t need to prove they sent the right data. Everyone looks at the same trace and the bottleneck - or the failure point - is simply visible.</p> <h2>The Dual-Layer Architecture</h2> <p>Problems happen in two places: the server and the browser. Traditional observability often ignores the browser entirely. But the user’s experience happens in the browser. Network issues, slow renders, client-side errors - these are invisible if you’re only watching the server.</p> <p>We instrument both.</p> <p><strong>Server-side</strong>: Next.js provides automatic instrumentation for server actions, API routes, and middleware. Every request that hits our server generates spans without us writing instrumentation code.</p> <p><strong>Browser-side</strong>: A custom OpenTelemetry implementation that captures what happens in the user’s actual environment. Page loads, component renders, API calls from the client, user interactions that trigger chains of events.</p> <p>The magic is in the correlation. When the browser makes an HTTP request, it includes a <code>traceparent</code> header:</p> <pre class="language-undefined"><!></pre> <p>That header tells the backend: “I’m part of trace <code>abc123</code>.” The backend extracts the ID, creates its own spans as children, and suddenly you have one trace spanning browser, API, and database. The user’s click, the server’s processing, the database’s query - all connected, all visible, all timed.</p> <p>When the frontend team says “we sent the request” and the backend team says “we never received it,” the trace settles it instantly. Either the browser span shows the request was sent, or it doesn’t. Either the server span shows it arrived, or it doesn’t. No more archaeology through timestamp correlations across separate log files.</p> <h2>The Sampling Reality</h2> <p>Here’s where theory meets economics.</p> <p>Tracing everything in production would generate terabytes of data. The bandwidth costs alone would be significant. The storage costs would be worse. And most of that data would be perfectly normal requests that nobody ever looks at.</p> <p>So we sample. But sampling naively creates its own problems. If you randomly sample 5% of spans, you get fragments - the beginning of a trace without the end, a database query without the API call that triggered it. Useless for debugging.</p> <p>Our approach: session-based sampling with error overrides.</p> <p><strong>In development</strong>: 100% sampling. Every trace, every span. You’re debugging, you need to see everything.</p> <p><strong>In production</strong>: 5% of sessions are sampled. The key word is <em>sessions</em>. We hash the session ID deterministically, and if that session falls in the sampled 5%, every span in that session is kept. You get complete traces, not random fragments. A coherent 5% sample tells you more than an incoherent 100%.</p> <p><strong>Errors</strong>: 100% sampling, always. When something fails, we keep the trace regardless of the session sampling decision. You never lose visibility into problems because of sampling.</p> <p><strong>Slow requests</strong>: If a request takes more than a second, it’s sampled. Performance problems are problems too.</p> <pre class="language-typescript"><!></pre> <p>The result: sustainable costs, coherent data, and guaranteed visibility into the things that matter.</p> <h2>Performance Without Sacrifice</h2> <p>Observability that slows down the application is self-defeating. You can’t measure performance while degrading it.</p> <p>The browser telemetry is lazy-loaded. It doesn’t block the initial page render. The user sees the application while the instrumentation initialises in the background. Bundle impact is under 150KB gzipped - substantial enough to take seriously, but not enough to noticeably affect load times.</p> <p>Traces are batched and exported asynchronously. The act of recording a span doesn’t block the operation being recorded. If the observability backend is unreachable, data is dropped silently rather than queued indefinitely or retried aggressively.</p> <p>Graceful degradation throughout. If telemetry initialisation fails, the application continues normally. Components check whether telemetry is available before attempting to use it. No user ever sees an error because observability broke.</p> <p>The overhead in production: under 2% with 5% sampling. Measurable if you’re looking for it, invisible to users.</p> <h2>What We Actually See Now</h2> <p>The dashboard shows services: <code>eos-frontend-browser</code>, <code>eos-frontend-main</code>, and downstream. You can search by trace ID, operation name, time range. Filter to errors only. Look at the waterfall view of a request’s complete lifecycle.</p> <p>When something breaks, we don’t start the archaeology. We find the trace. Often the user’s error report includes enough information to locate it - the time, the page, the action they were taking. Sometimes we search for error spans in the relevant time window.</p> <p>Either way, the debugging starts from understanding rather than guessing.</p> <p>The cross-team conversations changed too. “Check trace ID <code>abc123</code>” is a complete handoff. Frontend, backend, database - everyone sees the same story. The trace is the single source of truth about what happened.</p> <h2>Knight Capital’s Ghost</h2> <p>We’re not trading millions of dollars per second. An observability gap won’t bankrupt us in forty-five minutes. But the principle holds at any scale: when systems behave unexpectedly, the speed of understanding determines the cost of the problem.</p> <p>Knight Capital had alerts. They had monitoring. What they lacked was the ability to see the journey - to correlate individual actions into a coherent story fast enough to act on it.</p> <p>We can’t guarantee we’ll never have a production incident. But we can guarantee that when something goes wrong, we’ll be looking at the trace, not staring at dashboard alerts trying to manually reconstruct what the system should have been telling us all along.</p> <p>The error message is the tip of the iceberg. The trace shows you what’s underneath.</p> <hr/> <h2>Technical Notes</h2> <p><strong>Architecture:</strong></p> <ul><li>Server-side: Vercel OTEL integration for Next.js</li> <li>Browser-side: Custom OpenTelemetry with TelemetryProvider</li> <li>Trace correlation via <code>traceparent</code> header propagation</li> <li>Session-based sampling with error/slow-request overrides</li></ul> <p><strong>Key Files:</strong></p> <ul><li><code>packages/ui/providers/TelemetryProvider/</code> - React context and hooks</li> <li><code>services/modules/telemetry/</code> - Browser instrumentation services</li> <li><code>apps/*/instrumentation.ts</code> - Server-side OTEL registration</li></ul> <p><strong>Related Posts:</strong></p> <ul><li>FR-0005: The Server-Side Shield (security events need observability)</li> <li>FR-0001: The Multizone Gambit (tracing across zones)</li></ul> <p><strong>References:</strong></p> <ul><li><a href="https://en.wikipedia.org/wiki/Knight_Capital_Group#2012_stock_trading_disruption" rel="nofollow">Knight Capital Group Trading Loss</a></li> <li><a href="https://opentelemetry.io/docs/" rel="nofollow">OpenTelemetry Documentation</a></li> <li><a href="https://www.w3.org/TR/trace-context/" rel="nofollow">W3C Trace Context Specification</a></li></ul> <hr/> <h2>A Note on How This Was Written</h2> <p>As with all posts in this series, this was written with AI assistance. The architectural decisions and the legacy debugging frustrations are real. Knight Capital’s story informed our thinking about what observability actually means - not just having data, but being able to understand it fast enough to matter.</p>',1);function vn(p){var e=wn(),o=t(b(e),26),r=s(o);a(r,()=>`<code class="language-undefined">Trace ID: abc123 (Duration: 850ms)
│
├─ eventbus.publish [auth.signup.submit] (50ms)
│  └─ eventbus.handler_execution (35ms)
│     └─ auth.signup (600ms)
│        ├─ HTTP POST /api/auth/user-check (400ms)
│        │  └─ [Backend] Database query (50ms)
│        └─ eventbus.publish [auth.user-check.received] (50ms)
└─ navigation.redirect (5ms)</code>`),n(o);var i=t(o,18),l=s(i);a(l,()=>'<code class="language-undefined">traceparent: 00-&#123;trace-id&#125;-&#123;span-id&#125;-01</code>'),n(i);var c=t(i,24),m=s(c);a(m,()=>`<code class="language-typescript"><span class="token comment">// Configuration</span>
<span class="token constant">NEXT_PUBLIC_OTEL_TRACE_SAMPLE_RATE</span><span class="token operator">=</span><span class="token number">0.05</span>    <span class="token comment">// 5% in production</span>
<span class="token constant">NEXT_PUBLIC_OTEL_ERROR_SAMPLE_RATE</span><span class="token operator">=</span><span class="token number">1.0</span>     <span class="token comment">// 100% of errors</span></code>`),n(c),w(60),h(p,e)}const Tn=Object.freeze(Object.defineProperty({__proto__:null,default:vn,metadata:gs},Symbol.toStringTag,{value:"Module"})),ms={ref:"FR-0022",title:"One Doc Site to Rule Them All",description:"How we built a unified documentation site that serves engineers, product, and AI assistants equally well.",author:"Mark Basford",date:"2025-12-01T00:00:00.000Z",tags:["architecture","developer-experience","documentation","nextjs","mdx"],series:"Developer Experience",part:4,word_count:1150,estimated_reading_time:"8 min",published:!0,research_sources:["apps/docs/manifest.json","apps/docs/next.config.ts","BLOG-GUIDELINES.md"]},{ref:wa,title:va,description:Ta,author:Aa,date:xa,tags:_a,series:Sa,part:Ia,word_count:Ca,estimated_reading_time:Wa,published:Ra,research_sources:Ba}=ms;var An=g('<p>In 1086, William the Conqueror had a problem. He’d won England, but he didn’t know what he owned.</p> <p>Twenty years after Hastings, the kingdom was his in name, but the details were scattered across a thousand local records, held by a thousand local lords, written in formats nobody had standardised. What manors existed? How many ploughs worked the land? How many pigs? What was it all worth? William needed to know, and the only way to know was to count.</p> <p>So he sent commissioners to every corner of England. They surveyed every manor, recorded every acre, catalogued every pig. The result was the Domesday Book - a complete inventory of the realm. But here’s the thing: William didn’t move any of it. The pigs stayed in their fields. The manors stayed where they’d always been. The land didn’t relocate to Winchester. He simply created a manifest of what existed and where to find it.</p> <p>Nine centuries later, we faced a similar problem with documentation.</p> <h2>The Duplication Trap</h2> <p>Documentation lives where it’s written. ADRs sit in <code>docs/adr/</code>. Guides live in <code>docs/guides/</code>. Component PRDs nest inside <code>packages/ui/components/themis/docs/prd/</code>. Blog posts accumulate in <code>docs/blogs/</code>. Each document placed deliberately, close to the code it describes, where developers actually look for it.</p> <p>This works brilliantly for development. Need to understand the theme system? The guide is right there in <code>docs/guides/THEMES_GUIDE.md</code>. Working on the Button component? The PRD is in the same directory tree. AI assistants pick up context naturally because the documentation sits alongside the code they’re helping you write.</p> <p>But then you want a documentation site.</p> <p>The obvious approach: copy everything into the docs app. Create a <code>content/</code> directory, duplicate all the markdown, build your pages. The problem is immediate and permanent: you now maintain two copies of every document. Update the telemetry guide? Update it twice. Add a new ADR? Remember to copy it over. Forget once, and your docs site drifts from reality.</p> <p>We’ve seen this pattern before. It never ends well.</p> <h2>The Insight</h2> <p>The documents don’t need to move. They just need to be surveyed.</p> <p>Next.js handles MDX natively. The framework doesn’t care where the markdown lives - it just needs a path to read. A file at <code>../../docs/guides/TELEMETRY_GUIDE.md</code> renders exactly the same as one at <code>content/guides/telemetry.md</code>. The only difference is who maintains the path.</p> <p>So we built our own Domesday Book.</p> <pre class="language-json"><!></pre> <p>The manifest is a survey, not a container. It records where documents live without moving them. Add a new guide to <code>docs/guides/</code>, add a line to the manifest, done. The source of truth remains singular. The pigs stay in their fields.</p> <h2>Two Hours</h2> <p>This took two hours to implement. Not two days, not two sprints. Two hours, working with Claude.</p> <p>That’s not a boast about speed. It’s a statement about preparation.</p> <p>When we chose Next.js, documentation was part of the evaluation. Could we integrate MDX directly? Could we reference files outside the app directory? Could we build a docs site without duplicating content? The answer to all three was yes. We knew this before writing a line of application code.</p> <p>The multizone architecture (FR-0001) meant adding another zone was mechanical. Create the app, configure the port, add the nginx route. The pattern was established. The docs zone just followed it.</p> <p>The MDX support was native. No complex build pipelines, no static site generator bolted onto the side. Next.js reads markdown, renders it, done.</p> <p>Two hours because the hard decisions were already made.</p> <h2>Three Audiences, One Source</h2> <p>The docs site serves three distinct audiences from the same source files:</p> <p><strong>Developers</strong> get documentation where they work. The guides live in <code>docs/guides/</code>, right where you’d look for them. When you’re implementing telemetry, the guide is in context. When AI tools help you write code, they read the same guides you do. The files are positioned for maximum discoverability during development.</p> <p><strong>The Team</strong> gets a searchable, browsable documentation site. No more “where’s that ADR about theme management?” - it’s in the sidebar, organised, linked. New team members can explore the architecture without knowing where to look in the codebase first.</p> <p><strong>Customers</strong> - eventually - get product documentation that lives separately from the code but integrates seamlessly. A training guide can be written by the product team, stored wherever makes sense for them, and pulled into the customer-facing docs through the same manifest pattern. The content updates without deployments.</p> <p>Same files. Different presentations. Zero duplication.</p> <h2>The Kingdom, Catalogued</h2> <p>William’s commissioners didn’t just count pigs for the sake of counting. The Domesday Book let him tax accurately, settle disputes definitively, and understand his kingdom completely. The act of surveying created value that the scattered records never could.</p> <p>Our manifest does the same. The documents existed before. They were useful before. But scattered across directories, they were only useful to those who already knew where to look. The manifest brings them together without moving them, makes them discoverable without duplicating them, presents them professionally without maintaining them twice.</p> <p>Documentation stays current because it lives with the code. It stays useful because it’s presented alongside related docs. It stays maintained because there’s only one copy to maintain.</p> <p>One survey. One source of truth. One doc site to rule them all.</p> <hr/> <h2>Technical Notes</h2> <p><strong>Docs Zone Location:</strong> <code>apps/docs/</code></p> <p><strong>Key Files:</strong></p> <ul><li><code>manifest.json</code> - Maps document paths to slugs and navigation structure</li> <li><code>next.config.ts</code> - MDX configuration with Turbopack compatibility</li> <li><code>lib/mdx.ts</code> - Functions to read and parse MDX from manifest paths</li></ul> <p><strong>Pattern:</strong></p> <ul><li>Documents remain in original locations (<code>docs/</code>, <code>packages/*/docs/</code>)</li> <li>Manifest provides navigation structure and URL slugs</li> <li>MDX files rendered via <code>next-mdx-remote</code> for flexibility</li></ul> <p><strong>Related Posts:</strong></p> <ul><li>FR-0001: The Multizone Gambit (zone architecture)</li> <li>FR-0009: Writing for AI Assistants (documentation as context)</li> <li>FR-0011: The Shared Package Strategy (workspace organisation)</li></ul> <p><strong>Stack:</strong> Next.js 16, MDX, next-mdx-remote, Turbopack</p> <hr/> <h2>A Note on How This Was Written</h2> <p>As with all posts in this series, this was written with AI assistance. The architectural decisions, the Domesday Book parallel, and the reasoning are mine. The clarity, hopefully, comes from the collaboration. Every technical claim has been verified against the actual codebase.</p>',1);function xn(p){var e=An(),o=t(b(e),28),r=s(o);a(r,()=>`<code class="language-json"><span class="token punctuation">&#123;</span>
  <span class="token property">"guides"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Frontend"</span><span class="token punctuation">,</span>
      <span class="token property">"items"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Telemetry Guide"</span><span class="token punctuation">,</span>
          <span class="token property">"slug"</span><span class="token operator">:</span> <span class="token string">"frontend/telemetry"</span><span class="token punctuation">,</span>
          <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"../../docs/guides/TELEMETRY_GUIDE.md"</span>
        <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
        <span class="token punctuation">&#123;</span>
          <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"Themes Guide"</span><span class="token punctuation">,</span>
          <span class="token property">"slug"</span><span class="token operator">:</span> <span class="token string">"frontend/themes"</span><span class="token punctuation">,</span>
          <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"../../docs/guides/THEMES_GUIDE.md"</span>
        <span class="token punctuation">&#125;</span>
      <span class="token punctuation">]</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
  <span class="token property">"blog"</span><span class="token operator">:</span> <span class="token punctuation">[</span>
    <span class="token punctuation">&#123;</span>
      <span class="token property">"title"</span><span class="token operator">:</span> <span class="token string">"The Multizone Gambit"</span><span class="token punctuation">,</span>
      <span class="token property">"path"</span><span class="token operator">:</span> <span class="token string">"../../docs/blogs/FR-0001-the-multizone-gambit.md"</span><span class="token punctuation">,</span>
      <span class="token property">"slug"</span><span class="token operator">:</span> <span class="token string">"fr-0001-the-multizone-gambit"</span><span class="token punctuation">,</span>
      <span class="token property">"badge"</span><span class="token operator">:</span> <span class="token string">"Series"</span>
    <span class="token punctuation">&#125;</span>
  <span class="token punctuation">]</span>
<span class="token punctuation">&#125;</span></code>`),n(o),w(64),h(p,e)}const _n=Object.freeze(Object.defineProperty({__proto__:null,default:xn,metadata:ms},Symbol.toStringTag,{value:"Module"})),ys={ref:"WP-001",title:"Three layer component architecture",description:"How we built a unified documentation site that serves engineers, product, and AI assistants equally well.",author:"Mark Basford",date:"2025-12-07T00:00:00.000Z",tags:["white-paper","architecture","accessibility","documentation"],series:"White Paper",part:1,word_count:8741,estimated_reading_time:"45 mins",published:!0},{ref:La,title:Ea,description:Pa,author:Da,date:Na,tags:Ma,series:Oa,part:Fa,word_count:za,estimated_reading_time:ja,published:qa}=ys;var Sn=g('<h2>Reconciling Accessibility and Aesthetics in Modern UI Design</h2> <p><strong>A Comprehensive White Paper on Eliminating the False Choice Between WCAG Compliance and Visual Excellence</strong></p> <hr/> <p><strong>Author</strong>: Mark Basford <strong>Version</strong>: 1.0 <strong>Date</strong>: December 2025 <strong>Classification</strong>: Public</p> <hr/> <h2>Executive Summary</h2> <p>For over a decade, UI engineers have faced an impossible choice: build accessible interfaces that look chunky and outdated, or create beautiful, modern designs that fail users with disabilities. This trade-off has become so normalised that accessibility is often treated as an afterthought—a compliance checkbox rather than a fundamental design constraint.</p> <p>This white paper introduces the <strong>Three-Layer Component Architecture</strong>, a design pattern that eliminates this false dichotomy by separating interactive, visual, and content concerns into distinct, purpose-built layers. The pattern ensures WCAG 2.2 AAA compliance while enabling complete visual design freedom.</p> <h3>Key Findings from Our Research</h3> <table><thead><tr><th>Metric</th><th>Finding</th><th>Source</th></tr></thead><tbody><tr><td>Website failure rate</td><td><strong>94.8%</strong> of top 1M sites fail accessibility</td><td>WebAIM Million 2025</td></tr><tr><td>Touch error increase</td><td><strong>3x higher</strong> error rates for motor-impaired users on small targets</td><td>PMC Research</td></tr><tr><td>Conversion impact</td><td>Good UI increases conversion by up to <strong>400%</strong></td><td>Forrester Research (2009)</td></tr><tr><td>Legal risk</td><td><strong>2,019 lawsuits</strong> filed in H1 2025 (37% increase)</td><td>EcomBack Report</td></tr><tr><td>Widget failures</td><td><strong>456 lawsuits</strong> targeted sites using accessibility widgets</td><td>2025 Mid-Year Report</td></tr><tr><td>Framework correlation</td><td>React sites average <strong>50+ errors</strong>, Vue.js <strong>62+ errors</strong></td><td>WebAIM Million</td></tr></tbody></table> <p>The Three-Layer Architecture provides a path forward: uncompromising accessibility with unrestricted visual design. It’s not about choosing between users with disabilities and users who appreciate beautiful design—it’s about serving everyone excellently.</p> <hr/> <h2>Table of Contents</h2> <ol><li><a href="#part-i-a-decade-of-failure-the-state-of-web-accessibility-2015-2025">A Decade of Failure: The State of Web Accessibility (2015-2025)</a></li> <li><a href="#part-ii-the-human-cost-understanding-who-were-failing">The Human Cost: Understanding Who We’re Failing</a></li> <li><a href="#part-iii-why-current-solutions-dont-work">Why Current Solutions Don’t Work</a></li> <li><a href="#part-iv-the-business-case-aesthetics-matter-too">The Business Case: Aesthetics Matter Too</a></li> <li><a href="#part-v-introducing-the-three-layer-architecture">Introducing the Three-Layer Architecture</a></li> <li><a href="#part-vi-implementation-guide-building-a-button-component">Implementation Guide: Building a Button Component</a></li> <li><a href="#part-vii-addressing-the-gap-challenge">Addressing the Gap Challenge</a></li> <li><a href="#part-viii-related-approaches-and-prior-art">Related Approaches and Prior Art</a></li> <li><a href="#part-ix-conclusion-and-call-to-action">Conclusion and Call to Action</a></li> <li><a href="#references">References</a></li></ol> <hr/> <h1>Part I: A Decade of Failure: The State of Web Accessibility (2015-2025)</h1> <h2>The Birth of Modern Standards</h2> <p>The journey to our current accessibility crisis began with good intentions. The Web Content Accessibility Guidelines (WCAG) evolved through several major versions, each attempting to address the growing complexity of web applications:</p> <pre class="language-undefined"><!></pre> <p><strong>WCAG 1.0 (1999)</strong>: Focused primarily on HTML, with 14 guidelines and the A/AA/AAA conformance levels we still use today. This was a web of static pages—JavaScript was primitive, CSS barely existed, and mobile phones couldn’t browse the internet.</p> <p><strong>WCAG 2.0 (2008)</strong>: A decade-long effort produced technology-agnostic guidelines. The four principles—Perceivable, Operable, Understandable, Robust (POUR)—became the foundation. But by 2008, the iPhone had already launched, and the mobile revolution was underway.</p> <p><strong>WCAG 2.1 (2018)</strong>: Finally addressed mobile and cognitive accessibility with 17 new success criteria. Critically, this version introduced <strong>Success Criterion 2.5.5: Target Size (Enhanced)</strong> at Level AAA, requiring 44×44 CSS pixel touch targets. But because it was AAA (not AA), most organisations ignored it.</p> <p><strong>WCAG 2.2 (2023)</strong>: Added 9 new success criteria, including <strong>2.5.8: Target Size (Minimum)</strong> at Level AA, requiring 24×24 CSS pixels. This was progress, but the damage was done—a decade of mobile-first design had normalised tiny touch targets.</p> <h2>The WebAIM Million: Seven Years of Evidence</h2> <p>Since 2019, WebAIM has conducted annual accessibility analyses of the top one million websites. The results are damning:</p> <h3>Error Trends (2019-2025)</h3> <pre class="language-undefined"><!></pre> <h3>WCAG Failure Rates</h3> <table><thead><tr><th>Year</th><th>Failure Rate</th><th>Change</th><th>Errors/Page</th></tr></thead><tbody><tr><td>2019</td><td>97.8%</td><td>Baseline</td><td>59.6</td></tr><tr><td>2020</td><td>98.1%</td><td>+0.3%</td><td>60.9</td></tr><tr><td>2021</td><td>97.4%</td><td>-0.7%</td><td>51.4</td></tr><tr><td>2022</td><td>96.8%</td><td>-0.6%</td><td>50.8</td></tr><tr><td>2023</td><td>96.3%</td><td>-0.5%</td><td>50.0</td></tr><tr><td>2024</td><td>95.9%</td><td>-0.4%</td><td>56.8</td></tr><tr><td>2025</td><td>94.8%</td><td>-1.1%</td><td>51.0</td></tr></tbody></table> <p><strong>In seven years, the failure rate dropped by only 3 percentage points.</strong> At this rate, achieving broad web accessibility would take decades.</p> <h3>Page Complexity Growth</h3> <p>While error rates slowly declined, page complexity exploded:</p> <pre class="language-undefined"><!></pre> <p><strong>The web is getting more complex faster than it’s getting more accessible.</strong> Users with disabilities encounter an error approximately once every 24 elements they interact with.</p> <h3>The Six Persistent Failures</h3> <p>The same six error categories have dominated every single year since 2019:</p> <pre class="language-undefined"><!></pre> <p><strong>Addressing just these six issues would transform web accessibility.</strong> Yet year after year, they persist.</p> <h2>The Framework Factor</h2> <p>Modern JavaScript frameworks correlate with increased accessibility errors:</p> <pre class="language-undefined"><!></pre> <h3>The ARIA Paradox</h3> <p>Ironically, pages trying harder to be accessible often fail more:</p> <ul><li>ARIA usage has <strong>quadrupled</strong> since 2019 (now 89 ARIA attributes per page on average)</li> <li>Pages with ARIA present average <strong>34.2% more errors</strong> than pages without</li> <li>74.6% of home pages now use ARIA (up from 60.1% in 2019)</li></ul> <p>This isn’t because ARIA is bad—it’s because developers are using it incorrectly, without understanding the underlying accessibility principles.</p> <h2>The Legal Landscape (2024-2025)</h2> <p>The accessibility lawsuit landscape has intensified dramatically:</p> <h3>2024 Full Year Statistics</h3> <table><thead><tr><th>Metric</th><th>Value</th></tr></thead><tbody><tr><td>Total federal lawsuits</td><td>4,187</td></tr><tr><td>Year-over-year change</td><td>+7%</td></tr><tr><td>Repeat lawsuits (same company sued again)</td><td>41%</td></tr><tr><td>Lawsuits against widget users</td><td>25%+</td></tr><tr><td>Lawsuits since 2018</td><td>25,000+</td></tr></tbody></table> <h3>2025 First Half Statistics (H1 2025)</h3> <table><thead><tr><th>Metric</th><th>Value</th></tr></thead><tbody><tr><td>Lawsuits filed (Jan-Jun)</td><td>2,019</td></tr><tr><td>Year-over-year increase</td><td><strong>+37%</strong></td></tr><tr><td>Projected full-year total</td><td>~4,975</td></tr><tr><td>E-commerce targets</td><td>69% of cases</td></tr></tbody></table> <h3>Geographic Distribution (2025)</h3> <pre class="language-undefined"><!></pre> <p><strong>Illinois emerged as a new litigation hotspot with a 746% increase</strong>, signalling geographic expansion of accessibility litigation.</p> <h3>The Widget Illusion Shattered</h3> <p>In 2024-2025, the accessibility widget industry faced a reckoning:</p> <ul><li><strong>456 lawsuits</strong> in H1 2025 targeted sites using overlay widgets</li> <li><strong>$1 million FTC settlement</strong> with accessiBe for misleading compliance claims</li> <li><strong>22.6%</strong> of all lawsuits targeted widget-using sites</li> <li>Widgets failed to provide legal protection in <strong>100% of tested cases</strong></li></ul> <p><strong>Accessibility cannot be retrofitted with a JavaScript overlay.</strong> The architecture must be built right from the start.</p> <hr/> <h1>Part II: The Human Cost: Understanding Who We’re Failing</h1> <h2>Global Disability Statistics</h2> <p>The scale of digital exclusion is staggering:</p> <pre class="language-undefined"><!></pre> <p><strong>One in six people worldwide has a significant disability.</strong> This number is growing due to:</p> <ul><li>Increased longevity (age-related disabilities)</li> <li>Better diagnosis of cognitive conditions</li> <li>Rising rates of chronic conditions</li> <li>Improved survival rates from accidents and illness</li></ul> <h3>Motor Impairment: The Touch Target Crisis</h3> <p>Motor impairments directly impact the ability to interact with touchscreens:</p> <p><strong>Research Findings on Touch Interaction:</strong></p> <table><thead><tr><th>Finding</th><th>Impact</th></tr></thead><tbody><tr><td>Touch error increase</td><td><strong>3x higher</strong> pointing errors vs. mouse</td></tr><tr><td>Gesture completion time</td><td><strong>2x longer</strong> (3.4s vs 1.7s)</td></tr><tr><td>Gesture consistency</td><td><strong>49.7% lower</strong> consistency</td></tr><tr><td>Minimum recommended target</td><td><strong>18mm</strong> (updated from older research)</td></tr></tbody></table> <h3>The Fitts’ Law Problem</h3> <p>Fitts’ Law, a foundational principle of human-computer interaction, states that the time to acquire a target is a function of distance and target size. For touchscreens:</p> <pre class="language-undefined"><!></pre> <p><strong>Research on older adults and motor-impaired users shows:</strong></p> <ul><li>Error rates converge at <strong>12mm target size</strong> for both able-bodied and impaired users</li> <li>Below 12mm, impaired users experience <strong>disproportionately higher errors</strong></li> <li>Touch input introduces 3D movement complexity not captured by traditional Fitts’ models</li> <li>Right-handed users consistently deviate to the right when tapping</li></ul> <h3>The Smartphone Accessibility Gap</h3> <p>Despite smartphones being essential tools, significant gaps remain:</p> <table><thead><tr><th>Metric</th><th>People with Disabilities</th><th>General Population</th></tr></thead><tbody><tr><td>Smartphone ownership</td><td>72%</td><td>85%+</td></tr><tr><td>Internet access (household)</td><td>59.6%</td><td>90%+</td></tr><tr><td>Computer ownership</td><td>62%</td><td>81%</td></tr></tbody></table> <p><strong>72% of adults with disabilities own smartphones</strong>, but many struggle to use them effectively due to:</p> <ul><li>Small touch targets</li> <li>Complex gesture requirements</li> <li>Lack of customisation options</li> <li>Poor contrast and visibility</li></ul> <h3>Mild-to-Moderate Dexterity: The Invisible Majority</h3> <p>Beyond severe motor impairments lies a larger population:</p> <blockquote><p>“There is a broad group of technology users with less acute motor challenges where touch input is somewhat usable, but smartphone use still causes pain, frustration, embarrassment, and discrimination due to gaps in accessibility.”</p></blockquote> <p>This includes:</p> <ul><li><strong>Temporary conditions</strong>: Broken arm, surgery recovery, holding a baby</li> <li><strong>Situational impairments</strong>: Cold hands, wet fingers, moving vehicle</li> <li><strong>Age-related changes</strong>: Natural decline in fine motor control</li> <li><strong>Fatigue effects</strong>: End-of-day reduced dexterity</li></ul> <p><strong>Dexterity needs vary moment to moment</strong>, even for the same individual. A touch target that works in the morning may fail in the evening when fatigue sets in.</p> <hr/> <h1>Part III: Why Current Solutions Don’t Work</h1> <h2>The Framework Accessibility Problem</h2> <h3>React: Open but Undirected</h3> <p>React’s openness is both strength and weakness:</p> <p><strong>Strengths:</strong></p> <ul><li>Massive accessibility community</li> <li>Libraries like React Aria, Radix UI available</li> <li>Component-based architecture enables consistent patterns</li></ul> <p><strong>Weaknesses:</strong></p> <ul><li>No out-of-the-box accessibility features</li> <li>Documentation scattered and incomplete</li> <li>Developer responsible for all accessibility decisions</li> <li>Easy to create inaccessible patterns accidentally</li></ul> <h3>Angular: Structured but Underdocumented</h3> <p>Angular’s structure should help, but:</p> <p><strong>Strengths:</strong></p> <ul><li>Enforced project structure</li> <li>Angular Material A11y SDK available</li> <li>Modules enforce some coding standards</li></ul> <p><strong>Weaknesses:</strong></p> <ul><li>Accessibility documentation “lacking greatly”</li> <li>Not as many third-party accessibility add-ons</li> <li>A11y SDK coverage is incomplete</li></ul> <h3>Vue: Balanced but Underadopted</h3> <p>Vue offers perhaps the best balance:</p> <p><strong>Strengths:</strong></p> <ul><li>Well-written accessibility documentation</li> <li>Built-in accessibility features</li> <li>Good middle ground between React and Angular</li></ul> <p><strong>Weaknesses:</strong></p> <ul><li>Smaller ecosystem than React</li> <li>Fewer accessibility-focused libraries</li> <li>Still requires developer discipline</li></ul> <h3>The Real Problem</h3> <blockquote><p>“JavaScript frameworks like React, Angular and Vue have a very bad reputation when it comes to web accessibility. But is this due to inherent technical limitations or insurmountable problems of those tools?”</p></blockquote> <p><strong>The answer is neither.</strong> The problem is architectural—frameworks provide building blocks, but don’t enforce accessibility patterns. Developers can build anything, including inaccessible interfaces.</p> <h2>Material Design: The Beautiful Failure</h2> <p>Google’s Material Design is perhaps the most influential design system of the past decade. Yet its accessibility story is complicated:</p> <h3>Touch Target Guidelines</h3> <p>Material Design recommends:</p> <ul><li><strong>48×48 dp</strong> minimum touch target (Android)</li> <li>Visual elements can be smaller (24×24 dp icons common)</li> <li>Padding should extend touch target beyond visual bounds</li></ul> <pre class="language-undefined"><!></pre> <p><strong>In theory, this works.</strong> In practice:</p> <h3>The Implementation Gap</h3> <ol><li><strong>Developers misunderstand the model</strong>: They see “24×24 icon” and create 24×24 touch targets</li> <li><strong>Design tools don’t enforce it</strong>: Figma shows visual bounds, not touch targets</li> <li><strong>Code doesn’t enforce it</strong>: CSS doesn’t automatically add touch padding</li> <li><strong>Testing misses it</strong>: Visual tests pass, accessibility tests often absent</li></ol> <h3>Material UI (MUI) Accessibility Issues</h3> <p>Community-reported issues include:</p> <ul><li>Missing form labels in Data Grid dropdowns</li> <li>Broken ARIA references in Tabs component</li> <li>Select component labelling failures</li> <li>Focus management inconsistencies</li></ul> <p><strong>MUI acknowledges</strong>: “The overall accessibility of any project built with [MUI] depends in large part on the author’s markup, additional styling, and scripting they’ve included.”</p> <p>This is the fundamental problem: <strong>accessibility is the developer’s responsibility</strong>, not the framework’s guarantee.</p> <h2>Bootstrap: Colour Contrast Catastrophe</h2> <p>Bootstrap, used by millions of websites, has a documented accessibility problem:</p> <blockquote><p>“Most colors that currently make up Bootstrap’s default palette… lead to insufficient color contrast (below the recommended WCAG 2.0 color contrast ratio of 4.5:1) when used against a light background.”</p></blockquote> <h3>The Default Palette Problem</h3> <p>Bootstrap’s official documentation admits:</p> <ul><li>Default colours fail WCAG contrast requirements</li> <li>Authors must <strong>manually modify</strong> colours for compliance</li> <li>Templates advertising “WCAG 2.0 AA Compliant” often aren’t</li></ul> <p><strong>One analysis of a “compliant” Bootstrap template found:</strong></p> <ul><li>8 WCAG 2.0 AA coding errors</li> <li>16 alerts</li> <li>4 contrast errors</li> <li>On the front page alone</li></ul> <h3>The Evolution (and Its Limits)</h3> <p>Bootstrap has improved over versions:</p> <ul><li>Bootstrap 3.x: Significant accessibility issues</li> <li>Bootstrap 4.x: Some improvements, still colour problems</li> <li>Bootstrap 5.x: Better ARIA support, colour issues persist</li></ul> <p><strong>Bootstrap 5.3 claims</strong>: “It should be perfectly possible to create websites and applications with Bootstrap that fulfill WCAG 2.2 (A/AA/AAA).”</p> <p>Key word: <strong>“possible”</strong>. Not guaranteed. Not default. Possible.</p> <h2>The Headless UI Paradox</h2> <p>Headless UI libraries represent the state of the art in accessibility-aware component design:</p> <h3>What They Get Right</h3> <p><strong>Radix UI:</strong></p> <ul><li>WAI-ARIA compliant components</li> <li>Full keyboard navigation</li> <li>Focus management</li> <li>Screen reader support</li> <li>No styling opinions</li></ul> <p><strong>Headless UI (Tailwind):</strong></p> <ul><li>Unstyled, accessible primitives</li> <li>React and Vue support</li> <li>Seamless Tailwind integration</li></ul> <p><strong>React Aria (Adobe):</strong></p> <ul><li>Industry-leading accessibility</li> <li>30+ language translations</li> <li>13 calendar systems support</li> <li>Comprehensive ARIA implementation</li></ul> <h3>What They Don’t Solve</h3> <p>Despite excellence in behaviour, headless libraries don’t solve the touch target problem:</p> <pre class="language-undefined"><!></pre> <p><strong>A headless button is still whatever size the developer makes it.</strong> If the developer wants a 20px compact button, they get a 20px touch target—accessibility failure included.</p> <h2>The Accessibility Widget Disaster</h2> <p>The promise was appealing: add a single JavaScript snippet, and your site becomes accessible. Reality proved different.</p> <h3>The Promise vs. Reality</h3> <p><strong>Widget Companies Claimed:</strong></p> <ul><li>“One line of code for ADA compliance”</li> <li>“AI-powered accessibility”</li> <li>“Automatic WCAG conformance”</li></ul> <p><strong>Reality in 2024-2025:</strong></p> <ul><li>1,000+ widget-using sites sued in 2024</li> <li>456 widget-using sites sued in H1 2025</li> <li>$1M FTC settlement for false claims</li> <li>Zero legal protection demonstrated</li></ul> <h3>Why Widgets Fail</h3> <pre class="language-undefined"><!></pre> <p><strong>You cannot JavaScript your way to accessibility.</strong> It must be built into the architecture.</p> <hr/> <h1>Part IV: The Business Case: Aesthetics Matter Too</h1> <p>Before introducing our solution, we must address a critical concern: <strong>Does accessibility mean sacrificing beautiful design?</strong></p> <p>The research says no—in fact, good design and good accessibility reinforce each other.</p> <h2>The Aesthetic-Usability Effect</h2> <p>In 1995, researchers Masaaki Kurosu and Kaori Kashimura at Hitachi Design Center discovered something remarkable:</p> <blockquote><p>“Users are strongly influenced by the aesthetics of any given interface, even when they try to evaluate the underlying functionality of the system.”</p></blockquote> <p>They tested 26 ATM interface variations with 252 participants and found:</p> <ul><li>Stronger correlation between <strong>aesthetic appeal and perceived usability</strong> than between <strong>aesthetic appeal and actual usability</strong></li> <li>Attractive interfaces were perceived as easier to use, regardless of actual ease</li> <li>First impressions based on aesthetics influenced all subsequent evaluations</li></ul> <h3>The Tolerance Effect</h3> <p>Further research by Tractinsky et al. confirmed:</p> <blockquote><p>“Users are more tolerant of minor usability issues when they find an interface visually appealing.”</p></blockquote> <p>This has profound implications:</p> <ul><li>Beautiful interfaces get better user reviews</li> <li>Users persist longer with attractive designs</li> <li>Minor bugs are forgiven in well-designed products</li> <li>Ugly interfaces are abandoned faster, even if functional</li></ul> <h2>Conversion Rate Impact</h2> <p>The business case for beautiful design is overwhelming:</p> <pre class="language-undefined"><!></pre> <p><em>Note: The 200%/400% figures come from Forrester Research’s 2009 study “Leaving User Experience To Chance Hurts Companies” by Mike Gualtieri. While the specific percentages date from 2009, subsequent research has consistently validated the strong correlation between UX quality and conversion rates.</em></p> <h3>Real-World Case Studies</h3> <table><thead><tr><th>Company</th><th>Change</th><th>Result</th></tr></thead><tbody><tr><td>Walmart</td><td>Mobile UX improvements</td><td><strong>98% increase</strong> in mobile orders</td></tr><tr><td>Buyakilt.com</td><td>Added product filters</td><td><strong>26% increase</strong> in conversions</td></tr><tr><td>Hotel booking site</td><td>UX enhancements</td><td><strong>12.5% increase</strong> in bookings</td></tr></tbody></table> <h3>First Impression Window</h3> <p>Research from Microsoft Research shows:</p> <blockquote><p>“There is a 10-20 second window where a user decides whether a website is worth giving a chance or not.”</p></blockquote> <p>Within <strong>milliseconds</strong>, users form opinions about:</p> <ul><li>Trustworthiness</li> <li>Professionalism</li> <li>Quality</li> <li>Whether to stay or leave</li></ul> <p><strong>Ugly accessible beats beautiful inaccessible</strong>—but <strong>beautiful accessible beats both</strong>.</p> <h2>The False Dichotomy</h2> <p>The industry has created a false choice:</p> <pre class="language-undefined"><!></pre> <p>The Three-Layer Architecture recognises that <strong>what users see</strong> and <strong>what users touch</strong> don’t have to be the same element.</p> <hr/> <h1>Part V: Introducing the Three-Layer Architecture</h1> <h2>The Inspiration: Robert-Houdin’s Mystery Clock</h2> <p>In 1839, French clockmaker Jean-Eugène Robert-Houdin unveiled something that shouldn’t have been possible: a clock with transparent glass faces, no visible gears, no apparent mechanism—yet the hands moved precisely, as if by magic.</p> <p>The secret? A hidden second glass dial positioned behind the visible one, connected by a concealed rod running through the ornate base.</p> <p><strong>The invisible layer did all the work. The visible layer got all the attention.</strong></p> <p>This principle—separating what performs the function from what displays the result—is the foundation of the Three-Layer Architecture.</p> <h2>The Core Insight</h2> <blockquote><p><strong>The thing you touch doesn’t have to be the thing you see.</strong></p></blockquote> <p>Traditional component design conflates three distinct concerns:</p> <ol><li><strong>Interaction</strong>: Receiving clicks, touches, focus, keyboard events</li> <li><strong>Appearance</strong>: Colours, borders, shadows, animations</li> <li><strong>Content</strong>: Text, icons, state indicators</li></ol> <p>The Three-Layer Architecture separates these into purpose-built layers:</p> <pre class="language-undefined"><!></pre> <h2>Layer-by-Layer Breakdown</h2> <h3>Layer 1: The Accessibility Layer (Touch Target)</h3> <p><strong>Purpose</strong>: Ensures WCAG 2.2 AAA compliance for all pointer interactions</p> <p><strong>Characteristics</strong>:</p> <ul><li>Always 44×44 CSS pixels minimum (AAA) or 24×24 (AA minimum)</li> <li>Completely transparent—sighted users don’t see it</li> <li>Receives all pointer events</li> <li>Contains the focus ring for keyboard navigation</li> <li>Is the actual semantic element (<code>&lt;button&gt;</code>, <code>&lt;input&gt;</code>, etc.)</li></ul> <p><strong>Critical Design Decision</strong>: The focus ring belongs on Layer 1, not Layer 2. This ensures:</p> <ul><li>Focus ring is always 44×44px minimum (WCAG 2.4.13)</li> <li>Focus indicator is visible regardless of visual size</li> <li>Consistent focus behaviour across all visual variants</li></ul> <h3>Layer 2: The Visual Layer (Presentation)</h3> <p><strong>Purpose</strong>: Provides the designed appearance without accessibility constraints</p> <p><strong>Characteristics</strong>:</p> <ul><li>Any size the design requires</li> <li>Full theming support</li> <li>Animations and transitions</li> <li>Hover and pressed visual states</li> <li>Centred within Layer 1</li> <li>Typically a <code>&lt;span&gt;</code> or <code>&lt;div&gt;</code> (non-interactive)</li></ul> <p><strong>Critical Design Decision</strong>: Layer 2 has NO focus styles. Focus is handled by Layer 1.</p> <h3>Layer 3: The Content Layer (State Representation)</h3> <p><strong>Purpose</strong>: Displays content and communicates state visually</p> <p><strong>Characteristics</strong>:</p> <ul><li>Text labels, icons, symbols</li> <li>State indicators (loading spinners, checkmarks, etc.)</li> <li>Visual effects (ripples, animations)</li> <li>Purely presentational—no interactivity</li> <li><code>pointer-events: none</code> to prevent event capture</li></ul> <h2>Visual Comparison: Traditional vs. Three-Layer</h2> <pre class="language-undefined"><!></pre> <hr/> <h1>Part VI: Implementation Guide: Building a Button Component</h1> <p>Let’s build a production-ready Button component using the Three-Layer Architecture. This implementation uses React, TypeScript, React Aria, and Class Variance Authority (CVA).</p> <h2>Technology Stack</h2> <table><thead><tr><th>Technology</th><th>Purpose</th></tr></thead><tbody><tr><td>React</td><td>Component framework</td></tr><tr><td>TypeScript</td><td>Type safety</td></tr><tr><td>React Aria</td><td>Accessible primitives</td></tr><tr><td>CVA (Class Variance Authority)</td><td>Variant-based styling</td></tr><tr><td>Tailwind CSS</td><td>Utility classes</td></tr></tbody></table> <h2>Step 1: Define Layer 1 (Touch Target)</h2> <p>Layer 1 is the outermost element—the actual interactive button. It handles:</p> <ul><li>Minimum touch target size (44×44px)</li> <li>Focus ring for keyboard navigation</li> <li>Disabled state styling</li> <li>Pointer event handling</li></ul> <pre class="language-typescript"><!></pre> <h3>Key Design Decisions for Layer 1</h3> <ol><li><p><strong><code>min-h-[44px] min-w-[44px]</code></strong>: Ensures AAA touch target compliance regardless of visual size</p></li> <li><p><strong>Focus ring on Layer 1</strong>: The focus indicator wraps the entire 44×44px target, not just the visual element. This ensures keyboard users always see an adequately-sized focus indicator.</p></li> <li><p><strong>No background colour</strong>: Layer 1 is transparent—it shouldn’t be visible</p></li> <li><p><strong><code>disabled:pointer-events-none</code></strong>: Prevents interaction when disabled</p></li></ol> <h2>Step 2: Define Layer 2 (Visual Appearance)</h2> <p>Layer 2 provides the visual appearance. It can be any size, with any styling:</p> <pre class="language-typescript"><!></pre> <h3>Key Design Decisions for Layer 2</h3> <ol><li><p><strong><code>visualSize</code> prop</strong>: Explicitly named to indicate it controls ONLY the visual layer, not the touch target</p></li> <li><p><strong><code>dot</code> size</strong>: 20×20px visual inside a 44×44px touch target—perfect for carousel pagination</p></li> <li><p><strong>NO focus styles</strong>: Focus ring is on Layer 1. Layer 2 should never have <code>focus-visible:*</code> classes</p></li> <li><p><strong><code>data-[pressed]</code> instead of <code>:active</code></strong>: React Aria provides <code>isPressed</code> state, which we expose via data attributes for more reliable styling</p></li> <li><p><strong>CSS variables for theming</strong>: <code>var(--primary-action)</code> etc. enable runtime theming</p></li></ol> <h2>Step 3: Define Layer 3 (Content)</h2> <p>Layer 3 elements are nested inside Layer 2:</p> <pre class="language-typescript"><!></pre> <h2>Step 4: Compose the Component</h2> <pre class="language-typescript"><!></pre> <h2>Step 5: Usage Examples</h2> <h3>Standard Buttons</h3> <pre class="language-tsx"><!></pre> <h3>Icon Buttons</h3> <pre class="language-tsx"><!></pre> <h3>Carousel Dots</h3> <pre class="language-tsx"><!></pre> <h3>Loading States</h3> <pre class="language-tsx"><!></pre> <h2>Testing the Three-Layer Architecture</h2> <h3>Unit Tests</h3> <pre class="language-typescript"><!></pre> <h3>Visual Regression Tests</h3> <pre class="language-typescript"><!></pre> <h3>Accessibility Audits</h3> <pre class="language-typescript"><!></pre> <hr/> <h1>Part VII: Addressing the Gap Challenge</h1> <h2>The Spacing Problem</h2> <p>The Three-Layer Architecture has one significant trade-off: <strong>increased effective spacing between components</strong>.</p> <pre class="language-undefined"><!></pre> <p>This can make densely-packed UIs feel more spacious than intended.</p> <h2>Anti-Pattern: Overlapping Touch Targets with Z-Index</h2> <p>⚠️ <strong>DO NOT USE THIS APPROACH</strong></p> <p>A tempting but fundamentally flawed “solution” is to allow touch targets to overlap and use z-index to determine which element receives the tap:</p> <pre class="language-tsx"><!></pre> <pre class="language-undefined"><!></pre> <h2>Anti-Pattern: Negative Margins</h2> <p>⚠️ <strong>DO NOT USE THIS APPROACH</strong></p> <p>Using negative margins to pull touch targets closer creates the same problem as overlapping with z-index:</p> <pre class="language-css"><!></pre> <h3>Why These Are Harmful</h3> <ol><li><p><strong>Defeats the purpose</strong>: The whole point of 44px touch targets is to give users room for error. Overlapping means taps intended for one element activate another.</p></li> <li><p><strong>Punishes the users we’re trying to help</strong>: Motor-impaired users who need larger touch targets will experience MORE errors, not fewer.</p></li> <li><p><strong>Creates invisible interaction zones</strong>: Users have no way to know where one touch target ends and another begins.</p></li> <li><p><strong>Technical compliance ≠ usability</strong>: You might pass an automated audit, but you’ve made the interface actively worse for users with disabilities.</p></li></ol> <p><strong>The gap is the feature, not the problem.</strong> If your design can’t accommodate proper touch target spacing, redesign—don’t compromise accessibility.</p> <hr/> <h2>Anti-Pattern: Shared Touch Targets</h2> <p>⚠️ <strong>DO NOT USE THIS APPROACH</strong></p> <p>Another tempting “solution” is to wrap multiple controls in a single touch target container:</p> <pre class="language-tsx"><!></pre> <h3>Why This Is Harmful</h3> <ol><li><p><strong>Breaks keyboard navigation</strong>: Each interactive control needs its own focusable element. Users can’t tab to individual buttons inside a shared target.</p></li> <li><p><strong>Confuses screen readers</strong>: The relationship between the group container and child buttons creates ambiguous semantics. Screen readers may announce the group but not properly convey the individual controls.</p></li> <li><p><strong>Individual buttons still have small touch targets</strong>: The 44px container doesn’t magically make the 32px buttons inside easier to tap. Users still need to hit the small visual button.</p></li> <li><p><strong>Focus ring is on wrong element</strong>: The focus indicator appears on the container, not on the actual button being activated.</p></li></ol> <p><strong>Each interactive element needs its own 44px touch target.</strong> There are no shortcuts.</p> <hr/> <h2>Anti-Pattern: Responsive Touch Targets</h2> <p>⚠️ <strong>DO NOT USE THIS APPROACH</strong></p> <p>It’s tempting to reduce touch target sizes for “precise” input devices:</p> <pre class="language-css"><!></pre> <h3>Why This Is Harmful</h3> <ol><li><p><strong><code>pointer: fine</code> doesn’t mean “user has fine motor control”</strong>: It means the device has a precise pointing mechanism. A mouse is “fine” even when the user has tremors, arthritis, or other motor impairments.</p></li> <li><p><strong>Punishes desktop users with disabilities</strong>: Many people with motor impairments use desktop computers with mice. They need large touch targets MORE than mobile users, not less.</p></li> <li><p><strong>False assumptions about input methods</strong>:</p> <ul><li>Trackpads detect as <code>pointer: fine</code> but are harder to use precisely</li> <li>Styluses detect as <code>pointer: fine</code> but users may have shaky hands</li> <li>Touch-capable laptops can switch between touch and trackpad mid-session</li></ul></li> <li><p><strong>Violates the principle of progressive enhancement</strong>: Accessibility should be the baseline, not something that gets removed based on device capabilities.</p></li></ol> <p><strong>The 44px minimum applies to ALL input methods.</strong> Device precision ≠ user precision.</p> <hr/> <h2>Mitigation Strategy 1: Grid-Aware Spacing</h2> <p>Design your grid system to account for touch targets:</p> <pre class="language-css"><!></pre> <pre class="language-undefined"><!></pre> <h3>Why This Is Harmful</h3> <ol><li><p><strong>Creates overlapping touch targets</strong>: Negative margins cause touch targets to overlap, meaning taps near the boundary activate the wrong element.</p></li> <li><p><strong>Same result as z-index overlap</strong>: Whether you overlap via z-index stacking or negative margins, the outcome is identical—users who need the 44px target area will hit adjacent elements.</p></li> <li><p><strong>Unpredictable hit areas</strong>: The actual tappable region becomes smaller than the visual 44px, defeating the purpose of the Three-Layer Architecture entirely.</p></li> <li><p><strong>“Just a little overlap” is still harmful</strong>: Even 6px of overlap means the effective touch target is reduced by 12px (6px stolen from each side). A 44px target becomes 32px—back to failing WCAG AAA.</p></li></ol> <p><strong>If touch targets need to be adjacent, use grid-aware spacing with <code>gap: 0</code>.</strong> Never use negative margins to artificially compress spacing.</p> <h2>When Extra Spacing is Actually Good</h2> <p>In many contexts, the extra spacing is beneficial—and trying to eliminate it is solving a problem that doesn’t exist:</p> <table><thead><tr><th>Context</th><th>Why Extra Space Helps</th></tr></thead><tbody><tr><td>Mobile interfaces</td><td>Fat-finger-friendly, reduces mis-taps</td></tr><tr><td>Primary CTAs</td><td>Draws attention, creates visual hierarchy</td></tr><tr><td>Form controls</td><td>Breathing room improves scannability</td></tr><tr><td>All interfaces</td><td>Reduces cognitive load and visual clutter</td></tr><tr><td>Error-prone actions</td><td>Prevents accidental destructive clicks</td></tr></tbody></table> <p><strong>The “gap problem” is often imaginary.</strong> Before trying to eliminate spacing:</p> <ol><li><p><strong>Question the design requirement</strong>: Does the UI actually need to be denser? Compact designs often harm usability for everyone, not just users with disabilities.</p></li> <li><p><strong>Test with real users</strong>: Users with motor impairments consistently prefer more spacing, even when it makes the interface look “less modern.”</p></li> <li><p><strong>Consider the trade-offs</strong>: Every mitigation strategy has costs. Sometimes the cleanest solution is to accept the 44px spacing as a feature.</p></li></ol> <p><strong>Scenarios where you might genuinely need denser layouts:</strong></p> <ul><li>Dense data tables (but consider if the table design itself is the problem)</li> <li>Compact toolbars (but could these be redesigned with fewer icons?)</li> <li>Pagination/carousel dots (but use the Three-Layer Architecture—don’t shrink touch targets)</li> <li>Icon-only navigation (but should this be icon-only?)</li></ul> <p>For these specific cases, use the mitigation strategies above.</p> <hr/> <h1>Part VIII: Related Approaches and Prior Art</h1> <h2>React Aria’s Architecture</h2> <p>Adobe’s React Spectrum project pioneered the separation of concerns in accessible components:</p> <pre class="language-undefined"><!></pre> <p><strong>How it differs from Three-Layer:</strong></p> <ul><li>React Aria separates <strong>behavioural concerns</strong> (state, events, accessibility)</li> <li>Three-Layer separates <strong>spatial concerns</strong> (touch target, visual, content)</li> <li>They’re complementary—Three-Layer uses React Aria for Layer 1’s behaviour</li></ul> <h2>Headless UI Libraries</h2> <p>Radix UI, Headless UI, and similar libraries separate behaviour from styling:</p> <pre class="language-undefined"><!></pre> <p><strong>The Gap</strong>: Headless libraries don’t enforce touch target sizing. Three-Layer fills this gap.</p> <h2>Vue Renderless Components</h2> <p>Vue’s renderless component pattern provides behaviour without presentation:</p> <pre class="language-vue"><!></pre> <p><strong>Similarity</strong>: Separates behaviour from visuals <strong>Difference</strong>: Doesn’t address touch target sizing</p> <h2>Android Jetpack Compose</h2> <p>Compose automatically expands touch targets:</p> <blockquote><p>“Even when the visible touch target size of an interactive composable is smaller than Material Design’s minimum size, Jetpack Compose will also automatically apply an invisible touch target size region around such a composable so that its touch target size is at least 48dp by 48dp.”</p></blockquote> <p><strong>This is Three-Layer at the framework level!</strong> But:</p> <ul><li>Only available on Android</li> <li>Developers don’t have explicit control</li> <li>Can cause unexpected spacing issues</li></ul> <h2>CSS Pseudo-Element Pattern</h2> <p>A common CSS technique uses <code>::before</code> or <code>::after</code> for touch expansion:</p> <pre class="language-css"><!></pre> <p><strong>Limitations:</strong></p> <ul><li>Single pseudo-element limits other uses</li> <li>Doesn’t work well with focus rings</li> <li>No framework-level guarantees</li></ul> <h2>Comparison Table</h2> <table><thead><tr><th>Approach</th><th>Behaviour</th><th>Styling</th><th>Touch Target</th><th>Focus Ring</th></tr></thead><tbody><tr><td>Material UI</td><td>Integrated</td><td>Integrated</td><td>Padding-based</td><td>On element</td></tr><tr><td>Headless UI</td><td>Separated</td><td>Developer</td><td>Developer</td><td>Developer</td></tr><tr><td>React Aria</td><td>Separated</td><td>Developer</td><td>Developer</td><td>Developer</td></tr><tr><td>Jetpack Compose</td><td>Framework</td><td>Developer</td><td>Framework</td><td>Framework</td></tr><tr><td>CSS Pseudo</td><td>Manual</td><td>Integrated</td><td>Pseudo-element</td><td>Element</td></tr><tr><td><strong>Three-Layer</strong></td><td>Separated</td><td>Separated</td><td><strong>Architectural (Layer 1)</strong></td><td><strong>Layer 1</strong></td></tr></tbody></table> <p><strong>Three-Layer is unique in treating touch targets as an architectural layer</strong>, not a styling afterthought or framework magic.</p> <hr/> <h1>Part IX: Conclusion and Call to Action</h1> <h2>The Decade-Long Failure</h2> <p>For ten years, we’ve watched web accessibility stagnate:</p> <ul><li><strong>2015</strong>: 98%+ of websites fail accessibility standards</li> <li><strong>2025</strong>: 94.8% of websites still fail accessibility standards</li></ul> <p>Progress has been glacial. At current rates, achieving broad accessibility would take <strong>decades</strong>.</p> <p>Meanwhile:</p> <ul><li><strong>1.3 billion people</strong> live with disabilities</li> <li><strong>4,000+ lawsuits</strong> filed annually</li> <li><strong>$490 billion</strong> in spending power ignored</li> <li>Millions experience daily frustration, exclusion, and discrimination</li></ul> <h2>The False Choice is Over</h2> <p>The Three-Layer Architecture proves that accessibility and aesthetics are not opposing forces:</p> <pre class="language-undefined"><!></pre> <h2>For Engineering Leaders</h2> <p><strong>Adopt Three-Layer Architecture as your component standard:</strong></p> <ol><li><strong>Audit existing components</strong>: Identify touch target failures</li> <li><strong>Establish baseline</strong>: 44×44px minimum for Layer 1</li> <li><strong>Train teams</strong>: Separation of concerns for accessibility</li> <li><strong>Validate</strong>: Automated testing for each layer</li> <li><strong>Document</strong>: Make the architecture explicit</li></ol> <h2>For Designers</h2> <p><strong>Embrace the creative freedom:</strong></p> <ol><li><strong>Design without constraint</strong>: Visual layer is independent</li> <li><strong>Trust the architecture</strong>: Touch targets are handled</li> <li><strong>Focus on excellence</strong>: Accessibility is built in</li> <li><strong>Think in layers</strong>: Visual appearance ≠ touch target</li> <li><strong>Test with users</strong>: Validate both aesthetics and usability</li></ol> <h2>For the Industry</h2> <p><strong>It’s time to raise the standard:</strong></p> <ol><li><strong>Stop shipping inaccessible components</strong></li> <li><strong>Stop treating accessibility as optional</strong></li> <li><strong>Stop forcing the false choice</strong></li> <li><strong>Start building for everyone</strong></li></ol> <h2>The Path Forward</h2> <p>Web accessibility has been stuck for a decade because we’ve been approaching it wrong. We’ve treated it as:</p> <ul><li>A compliance checkbox (add ARIA attributes)</li> <li>A styling constraint (make buttons bigger)</li> <li>An overlay solution (JavaScript widgets)</li> <li>An optional enhancement (accessibility mode)</li></ul> <p><strong>None of these work.</strong></p> <p>The Three-Layer Architecture succeeds because it treats accessibility as what it actually is: <strong>an architectural concern</strong> that must be designed into the foundation of every component.</p> <p>The invisible layer does the work. The visible layer gets the attention. Everyone gets what they need.</p> <hr/> <h2>References</h2> <h3>WebAIM Million Reports</h3> <ul><li><a href="https://webaim.org/projects/million/" rel="nofollow">WebAIM Million 2025</a> - Latest annual report</li> <li><a href="https://webaim.org/projects/million/2024" rel="nofollow">WebAIM Million 2024</a></li> <li><a href="https://webaim.org/projects/million/2023" rel="nofollow">WebAIM Million 2023</a></li> <li><a href="https://webaim.org/projects/million/2022" rel="nofollow">WebAIM Million 2022</a></li> <li><a href="https://webaim.org/projects/million/2021" rel="nofollow">WebAIM Million 2021</a></li> <li><a href="https://webaim.org/projects/million/2020" rel="nofollow">WebAIM Million 2020</a></li> <li><a href="https://webaim.org/projects/million/2019" rel="nofollow">WebAIM Million 2019</a> - First report</li></ul> <h3>WCAG Standards</h3> <ul><li><a href="https://www.w3.org/WAI/WCAG21/Understanding/target-size.html" rel="nofollow">WCAG 2.5.5 Target Size (Enhanced)</a> - W3C</li> <li><a href="https://www.w3.org/WAI/WCAG22/Understanding/target-size-minimum.html" rel="nofollow">WCAG 2.5.8 Target Size (Minimum)</a> - W3C</li> <li><a href="https://accessibleweb.com/wcag/wcag-version-history/" rel="nofollow">WCAG Version History</a> - Accessible Web</li> <li><a href="https://www.accessibility.com/blog/a-timeline-of-wcag-and-digital-accessibility" rel="nofollow">Timeline of WCAG and Digital Accessibility</a></li></ul> <h3>Legal and Compliance</h3> <ul><li><a href="https://www.ecomback.com/ada-website-lawsuits-recap-report/2025-mid-year-ada-website-lawsuit-report" rel="nofollow">2025 Mid-Year ADA Lawsuit Report</a> - EcomBack</li> <li><a href="https://www.accessibility.works/blog/ada-lawsuit-trends-statistics-2024-summary/" rel="nofollow">ADA Lawsuit Trends 2024</a> - Accessibility.Works</li> <li><a href="https://www.audioeye.com/post/website-accessibility-in-2025/" rel="nofollow">Website Accessibility in 2025</a> - AudioEye</li> <li><a href="https://blog.usablenet.com/2025-midyear-accessibility-lawsuit-report-key-legal-trends" rel="nofollow">2025 Midyear Accessibility Lawsuit Report</a> - UsableNet</li></ul> <h3>Disability Statistics</h3> <ul><li><a href="https://www.who.int/teams/noncommunicable-diseases/sensory-functions-disability-and-rehabilitation/world-report-on-disability" rel="nofollow">World Report on Disability</a> - WHO</li> <li><a href="https://www.who.int/news-room/fact-sheets/detail/disability-and-health" rel="nofollow">Disability and Health Fact Sheet</a> - WHO</li> <li><a href="https://www.worldbank.org/en/topic/disability" rel="nofollow">Disability Inclusion Overview</a> - World Bank</li></ul> <h3>Motor Impairment Research</h3> <ul><li><a href="https://pmc.ncbi.nlm.nih.gov/articles/PMC3572909/" rel="nofollow">Touch Screen Performance by Individuals With and Without Motor Control Disabilities</a> - PMC</li> <li><a href="https://link.springer.com/article/10.1007/s10209-013-0320-5" rel="nofollow">Mobile touchscreen user interfaces: bridging the gap</a> - Springer</li> <li><a href="https://dl.acm.org/doi/fullHtml/10.1145/3597638.3608396" rel="nofollow">Smartphones Fail Users with Dexterity Differences</a> - ACM</li></ul> <h3>Framework Documentation</h3> <ul><li><a href="https://react-spectrum.adobe.com/react-aria/index.html" rel="nofollow">React Aria</a> - Adobe</li> <li><a href="https://react-spectrum.adobe.com/architecture.html" rel="nofollow">React Spectrum Architecture</a> - Adobe</li> <li><a href="https://www.radix-ui.com/" rel="nofollow">Radix UI</a></li> <li><a href="https://headlessui.com/" rel="nofollow">Headless UI</a> - Tailwind Labs</li> <li><a href="https://github.com/mui/material-ui/issues/21808" rel="nofollow">Material UI Accessibility</a></li> <li><a href="https://getbootstrap.com/docs/5.3/getting-started/accessibility/" rel="nofollow">Bootstrap Accessibility</a></li></ul> <h3>Design and UX Research</h3> <ul><li><a href="https://www.forrester.com/blogs/09-10-15-leaving_user_experience_to_chance_hurts_companies/" rel="nofollow">Leaving User Experience To Chance Hurts Companies</a> - Forrester Research (2009), source of the “400% conversion” statistic</li> <li><a href="https://www.nngroup.com/articles/aesthetic-usability-effect/" rel="nofollow">Aesthetic-Usability Effect</a> - Nielsen Norman Group</li> <li><a href="https://www.conversionry.com.au/blogs/news/the-impact-of-ux-design-on-conversion-rates" rel="nofollow">Impact of UX on Conversion Rates</a> - Conversionry</li> <li><a href="https://ishadeed.com/article/clickable-area/" rel="nofollow">Enhancing Clickable Area Size</a> - Ahmad Shadeed</li> <li><a href="https://docs.deque.com/devtools-mobile/2024.9.18/en/ios-touch-target-spacing/" rel="nofollow">Touch Target Spacing</a> - Deque</li></ul> <h3>Component Patterns</h3> <ul><li><a href="https://martinfowler.com/articles/headless-component.html" rel="nofollow">Headless Component Pattern</a> - Martin Fowler</li> <li><a href="https://www.patterns.dev/react/compound-pattern/" rel="nofollow">Compound Component Pattern</a> - Patterns.dev</li> <li><a href="https://www.patterns.dev/vue/renderless-components/" rel="nofollow">Renderless Components in Vue</a> - Patterns.dev</li> <li><a href="https://css-tricks.com/enhancing-the-clickable-area-size/" rel="nofollow">CSS Hit-Slop Techniques</a> - CSS-Tricks</li></ul> <hr/> <h2>Appendix A: Quick Reference Card</h2> <h3>The Three Layers</h3> <table><thead><tr><th>Layer</th><th>Element</th><th>Purpose</th><th>Size</th><th>Focus</th></tr></thead><tbody><tr><td>1</td><td><code>&lt;button&gt;</code> / AriaButton</td><td>Touch target</td><td>44×44px min</td><td>YES</td></tr><tr><td>2</td><td><code>&lt;span&gt;</code></td><td>Visual appearance</td><td>Any</td><td>NO</td></tr><tr><td>3</td><td>Children</td><td>Content & state</td><td>Fits L2</td><td>NO</td></tr></tbody></table> <h3>Touch Target Requirements</h3> <table><thead><tr><th>Standard</th><th>Minimum</th><th>Level</th><th>Notes</th></tr></thead><tbody><tr><td>WCAG 2.2</td><td>24×24px</td><td>AA</td><td>Legal minimum</td></tr><tr><td>WCAG 2.1</td><td>44×44px</td><td>AAA</td><td>Recommended</td></tr><tr><td>Apple iOS</td><td>44×44pt</td><td>-</td><td>Human Interface Guidelines</td></tr><tr><td>Android</td><td>48×48dp</td><td>-</td><td>Material Design</td></tr><tr><td>Microsoft</td><td>44×44px</td><td>-</td><td>Fluent Design</td></tr></tbody></table> <h3>Gap Mitigation Strategies</h3> <ol><li><strong>Grid-aware spacing</strong>: Design grid around 44px cells with <code>gap: 0</code></li> <li><strong>Accept the gap</strong>: In many cases, extra spacing improves usability for everyone</li></ol> <h3>Anti-Patterns to AVOID</h3> <p>❌ <strong>Overlapping touch targets with z-index</strong>: Higher z-index elements steal taps intended for adjacent elements.</p> <p>❌ <strong>Shared touch targets</strong>: Wrapping multiple controls in one container breaks keyboard navigation and screen reader semantics.</p> <p>❌ <strong>Responsive touch targets</strong>: Using <code>@media (pointer: fine)</code> assumes device precision = user ability.</p> <p>❌ <strong>Negative margins</strong>: Creates overlapping touch targets with the same harmful effects as z-index overlap.</p> <hr/> <h2>Appendix B: Implementation Checklist</h2> <h3>Component Development</h3> <ul class="contains-task-list"><li class="task-list-item"><input type="checkbox" disabled/> Layer 1 has <code>min-h-[44px] min-w-[44px]</code></li> <li class="task-list-item"><input type="checkbox" disabled/> Layer 1 is the semantic element (<code>&lt;button&gt;</code>, etc.)</li> <li class="task-list-item"><input type="checkbox" disabled/> Layer 1 has focus ring styles</li> <li class="task-list-item"><input type="checkbox" disabled/> Layer 1 is transparent (no background)</li> <li class="task-list-item"><input type="checkbox" disabled/> Layer 2 has NO focus ring styles</li> <li class="task-list-item"><input type="checkbox" disabled/> Layer 2 visual size controlled independently</li> <li class="task-list-item"><input type="checkbox" disabled/> Layer 3 has <code>pointer-events: none</code> where needed</li> <li class="task-list-item"><input type="checkbox" disabled/> Icon/dot variants require <code>aria-label</code></li> <li class="task-list-item"><input type="checkbox" disabled/> Loading state has <code>aria-live="polite"</code> announcement</li> <li class="task-list-item"><input type="checkbox" disabled/> Animations use <code>motion-safe:</code> prefix</li></ul> <h3>Testing</h3> <ul class="contains-task-list"><li class="task-list-item"><input type="checkbox" disabled/> Unit tests verify layer structure</li> <li class="task-list-item"><input type="checkbox" disabled/> Unit tests verify touch target size classes</li> <li class="task-list-item"><input type="checkbox" disabled/> Accessibility audit passes (jest-axe)</li> <li class="task-list-item"><input type="checkbox" disabled/> Visual regression tests capture appearance</li> <li class="task-list-item"><input type="checkbox" disabled/> Keyboard navigation works</li> <li class="task-list-item"><input type="checkbox" disabled/> Screen reader announces correctly</li> <li class="task-list-item"><input type="checkbox" disabled/> High contrast mode works</li> <li class="task-list-item"><input type="checkbox" disabled/> Reduced motion respected</li></ul> <h3>Documentation</h3> <ul class="contains-task-list"><li class="task-list-item"><input type="checkbox" disabled/> Layer architecture documented</li> <li class="task-list-item"><input type="checkbox" disabled/> <code>visualSize</code> prop explained</li> <li class="task-list-item"><input type="checkbox" disabled/> Accessibility requirements noted</li> <li class="task-list-item"><input type="checkbox" disabled/> Examples for all variants provided</li></ul> <hr/> <p><em>This white paper represents research and implementation experience by Mark Basford. The Three-Layer Architecture is implemented in the Themis component library.</em></p>',1);function In(p){var e=Sn(),o=t(b(e),36),r=s(o);a(r,()=>`<code class="language-undefined">Timeline of WCAG Development
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1999        2008        2018        2023        2024        Future
  │           │           │           │           │           │
  ▼           ▼           ▼           ▼           ▼           ▼
┌─────┐    ┌─────┐    ┌─────┐    ┌─────┐    ┌─────┐    ┌─────┐
│WCAG │    │WCAG │    │WCAG │    │WCAG │    │WCAG │    │WCAG │
│ 1.0 │    │ 2.0 │    │ 2.1 │    │ 2.2 │    │2.2.1│    │ 3.0 │
└─────┘    └─────┘    └─────┘    └─────┘    └─────┘    └─────┘
   │           │           │           │           │           │
   │           │           │           │           │           │
HTML-      Technology  Mobile &amp;   Focus      Update    Complete
focused    agnostic    cognitive  indicators            overhaul
14 guide-  61 success  +17 new    +9 new
lines      criteria    criteria   criteria</code>`),n(o);var i=t(o,16),l=s(i);a(l,()=>`<code class="language-undefined">Average Accessibility Errors Per Page
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

70 ┤
   │
60 ┤ ■ 59.6  ■ 60.9                                ■ 56.8
   │              ╲                               ╱      ╲
   │               ╲                             ╱        ╲
50 ┤                ■ 51.4  ■ 50.8  ■ 50.0  ━━━╱          ■ 51.0
   │
   │
40 ┤
   │
30 ┤
   │
20 ┤
   │
10 ┤
   │
 0 ┼────────────────────────────────────────────────────────────────────
     2019    2020    2021    2022    2023    2024    2025

Note: 2020 saw a slight INCREASE (60.9) before dramatic improvements in 2021-2023.
2024 saw a significant spike (56.8 errors) before improving in 2025 (51.0).</code>`),n(i);var c=t(i,12),m=s(c);a(m,()=>`<code class="language-undefined">Home Page Elements (Average)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1400 ┤
     │
1200 ┤                                                   ■ 1,257 (+61% since 2019)
     │                                              ╱
1000 ┤                               ■ 1,050  ■ 1,173
     │                          ╱
 800 ┤        ■ 864  ■ 887  ■ 955
     │   ╱
 600 ┤■ 782
     │
 400 ┤
     │
 200 ┤
     │
   0 ┼────────────────────────────────────────────────────────────────────
       2019   2020   2021   2022   2023   2024   2025

Data: 782 (2019) → 864 (2020) → 887 (2021) → 955 (2022) → 1,050 (2023) → 1,173 (2024) → 1,257 (2025)</code>`),n(c);var u=t(c,8),y=s(u);a(y,()=>`<code class="language-undefined">Distribution of Accessibility Errors (2025)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Low contrast text          ████████████████████████████████████████ 79.1%
                           (29.6 instances per page)

Missing alt text           ████████████████████████ 54.5%

Empty links                ██████████████████████ 48.6%

Missing form labels        ████████████████████ 46.1%
                           (Getting WORSE year-over-year)

Empty buttons              ██████████████████ 43.8%
                           (Getting WORSE year-over-year)

Missing document language  ████████████████ 37.9%

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
These 6 categories account for 96.4% of ALL detected errors</code>`),n(u);var k=t(u,8),T=s(k);a(T,()=>`<code class="language-undefined">Average Errors by Framework (2025)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

No framework    ████████████████████████████████████████████ ~45 errors

React           ██████████████████████████████████████████████████ 50.1 errors

Vue.js          ████████████████████████████████████████████████████████████ 62.3 errors

Bootstrap       +12.9 additional errors when present

jQuery UI       +15.2 additional errors when present</code>`),n(k);var v=t(k,24),I=s(v);a(I,()=>`<code class="language-undefined">ADA Lawsuit Distribution by State
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

New York        ████████████████████████████████ 31.6% (637 lawsuits)

Florida         ████████████████████████ 24.2% (487 lawsuits, +33% YoY)

California      ███████████████████ 18.9% (380 lawsuits)

Illinois        ████████████ 11.8% (237 lawsuits, +746% YoY!)

Other states    ██████████████ 13.5%</code>`),n(v);var C=t(v,20),B=s(C);a(B,()=>`<code class="language-undefined">Global Disability Population (2025)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

World Population: 8 billion
                  ████████████████████████████████████████████████████████

People with disabilities: 1.3 billion (16% - 1 in 6 people)
                          █████████

People with significant functional difficulties: 190-320 million (2-4%)
                                                 ██</code>`),n(C);var d=t(C,18),A=s(d);a(A,()=>`<code class="language-undefined">Movement Time = a + b × log₂(2D/W)

Where:
- D = distance to target
- W = width (size) of target
- Smaller W = exponentially longer acquisition time</code>`),n(d);var x=t(d,86),_=s(x);a(_,()=>`<code class="language-undefined">Material Design Touch Target Model
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

            ┌─────────────────────────────────────────┐
            │                                         │
            │           48×48 dp touch target         │
            │                                         │
            │         ┌─────────────────┐             │
            │         │                 │             │
            │         │   24×24 dp      │             │
            │         │   visual icon   │             │
            │         │                 │             │
            │         └─────────────────┘             │
            │                                         │
            │                                         │
            └─────────────────────────────────────────┘

&quot;An icon may appear to be 24×24 dp, but the padding surrounding
 it comprises the full 48×48 dp touch target.&quot;</code>`),n(x);var S=t(x,66),W=s(S);a(W,()=>`<code class="language-undefined">The Headless Library Gap
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Headless libraries provide:
├── ✓ Keyboard navigation
├── ✓ Focus management
├── ✓ ARIA attributes
├── ✓ Screen reader support
└── ✓ Behaviour patterns

Headless libraries DON&#39;T provide:
├── ✗ Touch target sizing
├── ✗ Visual/interactive layer separation
├── ✗ Automatic AAA compliance
└── ✗ Gap/spacing management

The developer still must:
├── Set appropriate sizes
├── Manage touch target vs visual size
├── Ensure contrast ratios
└── Handle high-contrast modes</code>`),n(S);var R=t(S,20),bs=s(R);a(bs,()=>`<code class="language-undefined">Why Accessibility Widgets Cannot Work
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. OVERLAY APPROACH
   ┌────────────────────────────────┐
   │  Original inaccessible site   │ ← Still there
   ├────────────────────────────────┤
   │  Widget JavaScript overlay    │ ← Tries to patch
   └────────────────────────────────┘

   Problems:
   - Can&#39;t change underlying HTML structure
   - Can&#39;t fix semantic issues
   - Can&#39;t add missing alt text accurately
   - Can&#39;t resize touch targets reliably

2. AI LIMITATIONS
   - AI can&#39;t determine intent
   - Alt text generation often wrong
   - Can&#39;t understand business context
   - &quot;A button&quot; isn&#39;t helpful

3. USER EXPERIENCE
   - Adds performance overhead
   - Creates inconsistent behaviour
   - Often conflicts with assistive tech
   - Users report worse experience with widgets</code>`),n(R);var L=t(R,36),fs=s(L);a(fs,()=>`<code class="language-undefined">Design Impact on Conversion Rates
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Good UI design alone:      up to 200% increase in conversions
                           ████████████████████████████████████████

Good UI + Good UX:         up to 400% increase in conversions
                           ████████████████████████████████████████████████████████████████████████████████

Design improvements only:  35% increase in conversions (Baymard Institute)
                           ██████████████

Checkout form redesign:    3.6% uplift = €450,000+/year revenue
(single experiment)        ██</code>`),n(L);var E=t(L,24),ws=s(E);a(ws,()=>`<code class="language-undefined">The Traditional Trade-off (FALSE)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

                    Accessibility ◄─────────────────────► Aesthetics
                         │                                     │
                         ▼                                     ▼
                  ┌──────────────┐                     ┌──────────────┐
                  │   44×44px    │                     │   20×20px    │
                  │   &quot;chunky&quot;   │                     │   &quot;sleek&quot;    │
                  │   toggle     │                     │   toggle     │
                  │              │                     │              │
                  │   ✓ WCAG     │                     │   ✗ WCAG     │
                  │   ✗ Modern   │                     │   ✓ Modern   │
                  └──────────────┘                     └──────────────┘

This is a false choice. The Three-Layer Architecture eliminates it.</code>`),n(E);var P=t(E,28),vs=s(P);a(vs,()=>`<code class="language-undefined">Three-Layer Component Architecture
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│                          LAYER 1: TOUCH TARGET                          │
│                                                                         │
│   • Minimum 44×44 CSS pixels (WCAG 2.2 AAA)                            │
│   • Completely transparent (invisible to sighted users)                 │
│   • Receives ALL pointer events (click, touch, hover)                   │
│   • Contains focus ring for keyboard navigation                         │
│   • The actual interactive element (button, input, etc.)                │
│                                                                         │
│   ┌─────────────────────────────────────────────────────────────────┐   │
│   │                                                                 │   │
│   │                    LAYER 2: VISUAL APPEARANCE                   │   │
│   │                                                                 │   │
│   │   • Any size the design requires (20px, 24px, 32px, etc.)      │   │
│   │   • Full theming support (colours, borders, shadows)           │   │
│   │   • Animation and transition effects                            │   │
│   │   • Hover and pressed visual states                             │   │
│   │   • Centred within Layer 1                                      │   │
│   │   • NO pointer events (pointer-events: none on children)        │   │
│   │                                                                 │   │
│   │   ┌─────────────────────────────────────────────────────────┐   │   │
│   │   │                                                         │   │   │
│   │   │              LAYER 3: CONTENT &amp; STATE                   │   │   │
│   │   │                                                         │   │   │
│   │   │   • Text labels, icons, symbols                         │   │   │
│   │   │   • State indicators (checked, loading, disabled)       │   │   │
│   │   │   • Visual effects (ripples, animations)                │   │   │
│   │   │   • Purely presentational                               │   │   │
│   │   │                                                         │   │   │
│   │   └─────────────────────────────────────────────────────────┘   │   │
│   │                                                                 │   │
│   └─────────────────────────────────────────────────────────────────┘   │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code>`),n(P);var D=t(P,36),Ts=s(D);a(Ts,()=>`<code class="language-undefined">Traditional Single-Layer Button
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

To meet 44px requirement:

┌──────────────────────────────────────────────┐
│                                              │  44px
│              Save Changes                    │  (looks chunky)
│                                              │
└──────────────────────────────────────────────┘

OR to look modern:

┌─────────────────────────┐
│     Save Changes        │  32px (fails WCAG AAA)
└─────────────────────────┘


Three-Layer Architecture
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

┌──────────────────────────────────────────────┐
│                                              │
│        ┌─────────────────────────┐           │  44px touch target
│        │     Save Changes        │           │  (invisible)
│        └─────────────────────────┘           │  32px visual
│                                              │  (looks modern)
└──────────────────────────────────────────────┘

Result: Looks like 32px. Touches like 44px. Everyone wins.</code>`),n(D);var N=t(D,18),As=s(N);a(As,()=>`<code class="language-typescript"><span class="token comment">/**
 * Layer 1: Transparent outer touch target (44x44px minimum)
 *
 * This layer handles the WCAG 2.2 AAA touch target requirement.
 * It is always transparent and centers the visual button inside.
 *
 * IMPORTANT: Focus ring stays on Layer 1 for AAA compliance (2.4.13)
 */</span>
<span class="token keyword">const</span> buttonOuterVariants <span class="token operator">=</span> <span class="token function">cva</span><span class="token punctuation">(</span>
  <span class="token comment">// Base styles - always applied</span>
  <span class="token punctuation">[</span>
    <span class="token comment">// Flexbox centering</span>
    <span class="token string">"inline-flex items-center justify-center"</span><span class="token punctuation">,</span>

    <span class="token comment">// WCAG 2.2 AAA: 44×44px minimum touch target</span>
    <span class="token string">"min-h-[44px] min-w-[44px]"</span><span class="token punctuation">,</span>

    <span class="token comment">// Focus ring on Layer 1 (not Layer 2!)</span>
    <span class="token string">"focus-visible:outline-none"</span><span class="token punctuation">,</span>
    <span class="token string">"focus-visible:ring-2"</span><span class="token punctuation">,</span>
    <span class="token string">"focus-visible:ring-[var(--ring)]"</span><span class="token punctuation">,</span>
    <span class="token string">"focus-visible:ring-offset-2"</span><span class="token punctuation">,</span>
    <span class="token string">"focus-visible:ring-offset-background"</span><span class="token punctuation">,</span>

    <span class="token comment">// Disabled state</span>
    <span class="token string">"disabled:pointer-events-none"</span><span class="token punctuation">,</span>
    <span class="token string">"disabled:opacity-50"</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    variants<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// Full width variant</span>
      fullWidth<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token boolean">true</span><span class="token operator">:</span> <span class="token string">"w-full"</span><span class="token punctuation">,</span>
        <span class="token boolean">false</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    defaultVariants<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      fullWidth<span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code>`),n(N);var M=t(N,10),xs=s(M);a(xs,()=>`<code class="language-typescript"><span class="token comment">/**
 * Layer 2: Visual button appearance (adjustable size)
 *
 * Provides the visual appearance with configurable size.
 * Can be smaller than touch target for use cases like carousel dots.
 *
 * NOTE: NO focus-visible styles here - focus ring is on Layer 1
 */</span>
<span class="token keyword">const</span> buttonVisualVariants <span class="token operator">=</span> <span class="token function">cva</span><span class="token punctuation">(</span>
  <span class="token comment">// Base styles</span>
  <span class="token punctuation">[</span>
    <span class="token string">"inline-flex items-center justify-center gap-2"</span><span class="token punctuation">,</span>
    <span class="token string">"whitespace-nowrap rounded-md"</span><span class="token punctuation">,</span>
    <span class="token string">"text-sm font-medium"</span><span class="token punctuation">,</span>
    <span class="token string">"ring-offset-background transition-colors"</span><span class="token punctuation">,</span>

    <span class="token comment">// SVG icons inside button</span>
    <span class="token string">"[&amp;_svg]:pointer-events-none"</span><span class="token punctuation">,</span>
    <span class="token string">"[&amp;_svg]:size-4"</span><span class="token punctuation">,</span>
    <span class="token string">"[&amp;_svg]:shrink-0"</span><span class="token punctuation">,</span>

    <span class="token comment">// For ripple effects</span>
    <span class="token string">"relative"</span><span class="token punctuation">,</span>
    <span class="token string">"cursor-pointer"</span><span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#123;</span>
    variants<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      <span class="token comment">// Visual variants (colours, borders)</span>
      variant<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">"bg-[var(--primary-action)]"</span><span class="token punctuation">,</span>
          <span class="token string">"text-[var(--primary-action-foreground)]"</span><span class="token punctuation">,</span>
          <span class="token string">"shadow-md"</span><span class="token punctuation">,</span>
          <span class="token string">"hover:bg-[var(--primary-action-hover)]"</span><span class="token punctuation">,</span>
          <span class="token string">"data-[pressed]:bg-[var(--primary-action)]/80"</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

        destructive<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">"bg-[var(--destructive-background)]"</span><span class="token punctuation">,</span>
          <span class="token string">"text-[var(--destructive-foreground)]"</span><span class="token punctuation">,</span>
          <span class="token string">"shadow-md"</span><span class="token punctuation">,</span>
          <span class="token string">"hover:bg-[var(--destructive-background)]/90"</span><span class="token punctuation">,</span>
          <span class="token string">"data-[pressed]:bg-[var(--destructive-background)]/80"</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

        outline<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">"border border-[var(--input-border)]"</span><span class="token punctuation">,</span>
          <span class="token string">"bg-[var(--page-background)]"</span><span class="token punctuation">,</span>
          <span class="token string">"hover:bg-[var(--input-border)]"</span><span class="token punctuation">,</span>
          <span class="token string">"data-[pressed]:bg-[var(--input-border)]"</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

        secondary<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">"bg-[var(--secondary)]"</span><span class="token punctuation">,</span>
          <span class="token string">"text-[var(--secondary-foreground)]"</span><span class="token punctuation">,</span>
          <span class="token string">"shadow-md"</span><span class="token punctuation">,</span>
          <span class="token string">"hover:bg-[var(--secondary)]/80"</span><span class="token punctuation">,</span>
          <span class="token string">"data-[pressed]:bg-[var(--secondary)]/70"</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

        ghost<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">"hover:bg-[var(--accent)]"</span><span class="token punctuation">,</span>
          <span class="token string">"hover:text-[var(--accent-foreground)]"</span><span class="token punctuation">,</span>
          <span class="token string">"data-[pressed]:bg-[var(--accent)]"</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">,</span>

        link<span class="token operator">:</span> <span class="token punctuation">[</span>
          <span class="token string">"text-[var(--text-link)]"</span><span class="token punctuation">,</span>
          <span class="token string">"underline-offset-4"</span><span class="token punctuation">,</span>
          <span class="token string">"hover:underline"</span><span class="token punctuation">,</span>
          <span class="token string">"data-[pressed]:text-[var(--text-link-hover)]"</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>

      <span class="token comment">// Visual size (independent of touch target!)</span>
      visualSize<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token keyword">default</span><span class="token operator">:</span> <span class="token string">"h-10 px-4 py-2"</span><span class="token punctuation">,</span>        <span class="token comment">// 40px height</span>
        sm<span class="token operator">:</span> <span class="token string">"h-9 rounded-md px-3 text-xs"</span><span class="token punctuation">,</span> <span class="token comment">// 36px height</span>
        lg<span class="token operator">:</span> <span class="token string">"h-11 rounded-md px-8"</span><span class="token punctuation">,</span>        <span class="token comment">// 44px height</span>
        icon<span class="token operator">:</span> <span class="token string">"h-10 w-10"</span><span class="token punctuation">,</span>                 <span class="token comment">// 40×40px square</span>
        dot<span class="token operator">:</span> <span class="token string">"h-5 w-5 rounded-full p-0 min-h-0 min-w-0"</span><span class="token punctuation">,</span> <span class="token comment">// 20×20px dot</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>

      <span class="token comment">// Full width</span>
      fullWidth<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
        <span class="token boolean">true</span><span class="token operator">:</span> <span class="token string">"w-full"</span><span class="token punctuation">,</span>
        <span class="token boolean">false</span><span class="token operator">:</span> <span class="token string">""</span><span class="token punctuation">,</span>
      <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    defaultVariants<span class="token operator">:</span> <span class="token punctuation">&#123;</span>
      variant<span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>
      visualSize<span class="token operator">:</span> <span class="token string">"default"</span><span class="token punctuation">,</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">;</span></code>`),n(M);var O=t(M,10),_s=s(O);a(_s,()=>`<code class="language-typescript"><span class="token comment">// Layer 3 elements are typically inline in the JSX</span>
<span class="token comment">// But for loading spinners, we can define consistent styles:</span>

<span class="token keyword">const</span> loadingSpinnerStyles <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">"motion-safe:animate-spin"</span><span class="token punctuation">,</span>  <span class="token comment">// WCAG 2.3.3: Respect reduced motion</span>
<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token keyword">const</span> rippleEffectStyles <span class="token operator">=</span> <span class="token punctuation">[</span>
  <span class="token string">"absolute inset-0"</span><span class="token punctuation">,</span>
  <span class="token string">"rounded-[inherit]"</span><span class="token punctuation">,</span>
  <span class="token string">"bg-current opacity-10"</span><span class="token punctuation">,</span>
  <span class="token string">"motion-safe:animate-in motion-safe:zoom-in-95"</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">join</span><span class="token punctuation">(</span><span class="token string">" "</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>`),n(O);var F=t(O,4),Ss=s(F);a(Ss,()=>`<code class="language-typescript"><span class="token string">"use client"</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> forwardRef<span class="token punctuation">,</span> memo<span class="token punctuation">,</span> useId<span class="token punctuation">,</span> <span class="token keyword">type</span> <span class="token class-name">ReactNode</span> <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span>
  Button <span class="token keyword">as</span> AriaButton<span class="token punctuation">,</span>
  <span class="token keyword">type</span> <span class="token class-name">ButtonProps</span> <span class="token keyword">as</span> AriaButtonProps<span class="token punctuation">,</span>
<span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'react-aria-components'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> cva<span class="token punctuation">,</span> <span class="token keyword">type</span> <span class="token class-name">VariantProps</span> <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'class-variance-authority'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> Loader2 <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'lucide-react'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token punctuation">&#123;</span> cn <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'../../utils/cn'</span><span class="token punctuation">;</span>

<span class="token comment">// ... CVA definitions from above ...</span>

<span class="token keyword">export</span> <span class="token keyword">interface</span> <span class="token class-name">ButtonProps</span>
  <span class="token keyword">extends</span> <span class="token class-name">Omit<span class="token operator">&lt;</span>AriaButtonProps<span class="token punctuation">,</span> <span class="token string">'className'</span><span class="token operator">></span></span><span class="token punctuation">,</span>
    VariantProps<span class="token operator">&lt;</span><span class="token keyword">typeof</span> buttonVisualVariants<span class="token operator">></span> <span class="token punctuation">&#123;</span>
  loading<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>
  loadingText<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  shortcut<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  className<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  buttonVisualClassName<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">string</span><span class="token punctuation">;</span>
  children<span class="token operator">?</span><span class="token operator">:</span> ReactNode<span class="token punctuation">;</span>
  fullWidth<span class="token operator">?</span><span class="token operator">:</span> <span class="token builtin">boolean</span><span class="token punctuation">;</span>

  <span class="token comment">/**
   * Visual size of the button (Layer 2)
   * The touch target (Layer 1) is ALWAYS 44×44px minimum
   *
   * @example
   * &lt;Button visualSize="dot" /> // 44px touch, 20px visual
   */</span>
  visualSize<span class="token operator">?</span><span class="token operator">:</span> <span class="token string">'sm'</span> <span class="token operator">|</span> <span class="token string">'default'</span> <span class="token operator">|</span> <span class="token string">'lg'</span> <span class="token operator">|</span> <span class="token string">'icon'</span> <span class="token operator">|</span> <span class="token string">'dot'</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/**
 * Button Component - 3-Layer Architecture
 *
 * Layer 1: Touch Target (AriaButton) - 44×44px WCAG AAA compliant
 * Layer 2: Visual Button (span) - configurable appearance
 * Layer 3: Content (children) - text, icons, effects
 */</span>
<span class="token keyword">const</span> Button <span class="token operator">=</span> <span class="token function">memo</span><span class="token punctuation">(</span><span class="token generic-function"><span class="token function">forwardRef</span><span class="token generic class-name"><span class="token operator">&lt;</span>HTMLButtonElement<span class="token punctuation">,</span> ButtonProps<span class="token operator">></span></span></span><span class="token punctuation">(</span>
  <span class="token punctuation">(</span>
    <span class="token punctuation">&#123;</span>
      className<span class="token punctuation">,</span>
      buttonVisualClassName<span class="token punctuation">,</span>
      variant<span class="token punctuation">,</span>
      visualSize <span class="token operator">=</span> <span class="token string">'default'</span><span class="token punctuation">,</span>
      fullWidth<span class="token punctuation">,</span>
      loading <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
      loadingText <span class="token operator">=</span> <span class="token string">"Loading..."</span><span class="token punctuation">,</span>
      shortcut<span class="token punctuation">,</span>
      children<span class="token punctuation">,</span>
      isDisabled<span class="token punctuation">,</span>
      <span class="token operator">...</span>props
    <span class="token punctuation">&#125;</span><span class="token punctuation">,</span>
    ref
  <span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token comment">// Development warning for accessibility</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>process<span class="token punctuation">.</span>env<span class="token punctuation">.</span><span class="token constant">NODE_ENV</span> <span class="token operator">!==</span> <span class="token string">'production'</span><span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>
        <span class="token punctuation">(</span>visualSize <span class="token operator">===</span> <span class="token string">'dot'</span> <span class="token operator">||</span> visualSize <span class="token operator">===</span> <span class="token string">'icon'</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span>
        <span class="token operator">!</span>props<span class="token punctuation">[</span><span class="token string">'aria-label'</span><span class="token punctuation">]</span> <span class="token operator">&amp;&amp;</span>
        <span class="token operator">!</span>children
      <span class="token punctuation">)</span> <span class="token punctuation">&#123;</span>
        <span class="token builtin">console</span><span class="token punctuation">.</span><span class="token function">warn</span><span class="token punctuation">(</span>
          <span class="token string">'[Button] visualSize="dot" or "icon" requires aria-label '</span> <span class="token operator">+</span>
          <span class="token string">'when no visible text is provided (WCAG 1.1.1)'</span>
        <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">&#125;</span>
    <span class="token punctuation">&#125;</span>

    <span class="token keyword">return</span> <span class="token punctuation">(</span>
      <span class="token comment">// LAYER 1: Touch Target</span>
      <span class="token operator">&lt;</span>AriaButton
        ref<span class="token operator">=</span><span class="token punctuation">&#123;</span>ref<span class="token punctuation">&#125;</span>
        isDisabled<span class="token operator">=</span><span class="token punctuation">&#123;</span>isDisabled <span class="token operator">||</span> loading<span class="token punctuation">&#125;</span>
        className<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token function">cn</span><span class="token punctuation">(</span><span class="token function">buttonOuterVariants</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span> fullWidth <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span> className<span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
        <span class="token punctuation">&#123;</span><span class="token operator">...</span>props<span class="token punctuation">&#125;</span>
      <span class="token operator">></span>
        <span class="token punctuation">&#123;</span><span class="token punctuation">(</span>renderProps<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
          <span class="token comment">// LAYER 2: Visual Button</span>
          <span class="token operator">&lt;</span>span
            className<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token function">cn</span><span class="token punctuation">(</span>
              <span class="token function">buttonVisualVariants</span><span class="token punctuation">(</span><span class="token punctuation">&#123;</span>
                variant<span class="token punctuation">,</span>
                visualSize<span class="token punctuation">,</span>
                fullWidth<span class="token punctuation">,</span>
              <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              buttonVisualClassName
            <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
            data<span class="token operator">-</span>pressed<span class="token operator">=</span><span class="token punctuation">&#123;</span>renderProps<span class="token punctuation">.</span>isPressed <span class="token operator">||</span> <span class="token keyword">undefined</span><span class="token punctuation">&#125;</span>
          <span class="token operator">></span>
            <span class="token punctuation">&#123;</span><span class="token comment">/* LAYER 3: Content &amp; Effects */</span><span class="token punctuation">&#125;</span>

            <span class="token punctuation">&#123;</span><span class="token comment">/* Loading state */</span><span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#123;</span>loading <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
              <span class="token operator">&lt;</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>Loader2
                  className<span class="token operator">=</span><span class="token string">"motion-safe:animate-spin"</span>
                  aria<span class="token operator">-</span>hidden<span class="token operator">=</span><span class="token string">"true"</span>
                <span class="token operator">/</span><span class="token operator">></span>
                <span class="token operator">&lt;</span>span className<span class="token operator">=</span><span class="token string">"sr-only"</span> aria<span class="token operator">-</span>live<span class="token operator">=</span><span class="token string">"polite"</span><span class="token operator">></span>
                  <span class="token punctuation">&#123;</span>loadingText<span class="token punctuation">&#125;</span>
                <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
              <span class="token operator">&lt;</span><span class="token operator">/</span><span class="token operator">></span>
            <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>

            <span class="token punctuation">&#123;</span><span class="token comment">/* Normal content */</span><span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#123;</span><span class="token operator">!</span>loading <span class="token operator">&amp;&amp;</span> children<span class="token punctuation">&#125;</span>

            <span class="token punctuation">&#123;</span><span class="token comment">/* Keyboard shortcut hint (visible on focus) */</span><span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#123;</span>renderProps<span class="token punctuation">.</span>isFocusVisible <span class="token operator">&amp;&amp;</span> shortcut <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
              <span class="token operator">&lt;</span>kbd className<span class="token operator">=</span><span class="token string">"ml-auto hidden text-xs opacity-60 lg:inline"</span><span class="token operator">></span>
                <span class="token punctuation">&#123;</span>shortcut<span class="token punctuation">&#125;</span>
              <span class="token operator">&lt;</span><span class="token operator">/</span>kbd<span class="token operator">></span>
            <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>

            <span class="token punctuation">&#123;</span><span class="token comment">/* Press ripple effect */</span><span class="token punctuation">&#125;</span>
            <span class="token punctuation">&#123;</span>renderProps<span class="token punctuation">.</span>isPressed <span class="token operator">&amp;&amp;</span> <span class="token punctuation">(</span>
              <span class="token operator">&lt;</span>span
                className<span class="token operator">=</span>"absolute inset<span class="token operator">-</span><span class="token number">0</span> rounded<span class="token operator">-</span><span class="token punctuation">[</span>inherit<span class="token punctuation">]</span> bg<span class="token operator">-</span>current
                           opacity<span class="token operator">-</span><span class="token number">10</span> motion<span class="token operator">-</span>safe<span class="token operator">:</span>animate<span class="token operator">-</span><span class="token keyword">in</span>
                           motion<span class="token operator">-</span>safe<span class="token operator">:</span>zoom<span class="token operator">-</span><span class="token keyword">in</span><span class="token operator">-</span><span class="token number">95</span>"
                aria<span class="token operator">-</span>hidden<span class="token operator">=</span><span class="token string">"true"</span>
              <span class="token operator">/</span><span class="token operator">></span>
            <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
          <span class="token operator">&lt;</span><span class="token operator">/</span>span<span class="token operator">></span>
        <span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
      <span class="token operator">&lt;</span><span class="token operator">/</span>AriaButton<span class="token operator">></span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

Button<span class="token punctuation">.</span>displayName <span class="token operator">=</span> <span class="token string">"Button"</span><span class="token punctuation">;</span>

<span class="token keyword">export</span> <span class="token punctuation">&#123;</span> Button<span class="token punctuation">,</span> buttonOuterVariants<span class="token punctuation">,</span> buttonVisualVariants <span class="token punctuation">&#125;</span><span class="token punctuation">;</span></code>`),n(F);var z=t(F,6),Is=s(z);a(Is,()=>`<code class="language-tsx"><span class="token comment">// Default button - 40px visual, 44px touch</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span><span class="token punctuation">></span></span><span class="token plain-text">Save Changes</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">></span></span>

<span class="token comment">// Small button - 36px visual, 44px touch</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">visualSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>sm<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Cancel</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">></span></span>

<span class="token comment">// Large button - 44px visual, 44px touch</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">visualSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>lg<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Submit Application</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">></span></span></code>`),n(z);var j=t(z,4),Cs=s(j);a(Cs,()=>`<code class="language-tsx"><span class="token comment">// Icon button - 40px visual, 44px touch</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">visualSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>icon<span class="token punctuation">"</span></span> <span class="token attr-name">aria-label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Settings<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">SettingsIcon</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">></span></span>

<span class="token comment">// Tiny icon - requires aria-label!</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">visualSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>icon<span class="token punctuation">"</span></span> <span class="token attr-name">aria-label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Close dialog<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">XIcon</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>h-4 w-4<span class="token punctuation">"</span></span> <span class="token punctuation">/></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">></span></span></code>`),n(j);var q=t(j,4),Ws=s(q);a(Ws,()=>`<code class="language-tsx"><span class="token comment">// Carousel pagination - 20px visual, 44px touch</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>flex gap-0<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token punctuation">&#123;</span>slides<span class="token punctuation">.</span><span class="token function">map</span><span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">(</span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span>
      <span class="token attr-name">key</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>index<span class="token punctuation">&#125;</span></span>
      <span class="token attr-name">visualSize</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>dot<span class="token punctuation">"</span></span>
      <span class="token attr-name">aria-label</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">Go to slide </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>index <span class="token operator">+</span> <span class="token number">1</span><span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">&#125;</span></span>
      <span class="token attr-name">variant</span><span class="token script language-javascript"><span class="token script-punctuation punctuation">=</span><span class="token punctuation">&#123;</span>currentSlide <span class="token operator">===</span> index <span class="token operator">?</span> <span class="token string">"default"</span> <span class="token operator">:</span> <span class="token string">"ghost"</span><span class="token punctuation">&#125;</span></span>
    <span class="token punctuation">/></span></span>
  <span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code>`),n(q);var G=t(q,4),Rs=s(G);a(Rs,()=>`<code class="language-tsx"><span class="token comment">// Loading with screen reader announcement</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">loading</span> <span class="token attr-name">loadingText</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Saving your changes...<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  Save
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">></span></span></code>`),n(G);var H=t(G,6),Bs=s(H);a(Bs,()=>`<code class="language-typescript"><span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'3-Layer Architecture'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Layer Structure'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'renders outer touch target element (Layer 1)'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Button<span class="token operator">></span>Test<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> button <span class="token operator">=</span> screen<span class="token punctuation">.</span><span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>button<span class="token punctuation">.</span>tagName<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBe</span><span class="token punctuation">(</span><span class="token string">'BUTTON'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'renders inner visual span element (Layer 2)'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Button<span class="token operator">></span>Test<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> button <span class="token operator">=</span> screen<span class="token punctuation">.</span><span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> visualLayer <span class="token operator">=</span> button<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>visualLayer<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeInTheDocument</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'touch target has WCAG-compliant minimum size classes'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Button<span class="token operator">></span>Test<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> button <span class="token operator">=</span> screen<span class="token punctuation">.</span><span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>button<span class="token punctuation">.</span>className<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">'min-h-[44px]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>button<span class="token punctuation">.</span>className<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">'min-w-[44px]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'visual layer receives variant styling'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Button variant<span class="token operator">=</span><span class="token string">"destructive"</span><span class="token operator">></span>Test<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> button <span class="token operator">=</span> screen<span class="token punctuation">.</span><span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> visualLayer <span class="token operator">=</span> button<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>visualLayer<span class="token operator">?.</span>className<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">'bg-[var(--destructive)]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Visual Size Independence'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'visualSize="dot" renders small visual inside large touch target'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Button visualSize<span class="token operator">=</span><span class="token string">"dot"</span> aria<span class="token operator">-</span>label<span class="token operator">=</span><span class="token string">"Dot"</span><span class="token operator">></span><span class="token punctuation">.</span><span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> button <span class="token operator">=</span> screen<span class="token punctuation">.</span><span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> visualLayer <span class="token operator">=</span> button<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Touch target: 44px minimum</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>button<span class="token punctuation">.</span>className<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">'min-h-[44px]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>button<span class="token punctuation">.</span>className<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">'min-w-[44px]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Visual layer: 20px</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>visualLayer<span class="token operator">?.</span>className<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">'h-5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>visualLayer<span class="token operator">?.</span>className<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">'w-5'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'touch target size unchanged regardless of visualSize'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> rerender <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>Button visualSize<span class="token operator">=</span><span class="token string">"dot"</span> aria<span class="token operator">-</span>label<span class="token operator">=</span><span class="token string">"Dot"</span> <span class="token operator">/</span><span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">let</span> button <span class="token operator">=</span> screen<span class="token punctuation">.</span><span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>button<span class="token punctuation">.</span>className<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">'min-h-[44px]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token function">rerender</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Button visualSize<span class="token operator">=</span><span class="token string">"lg"</span><span class="token operator">></span>Large<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      button <span class="token operator">=</span> screen<span class="token punctuation">.</span><span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>button<span class="token punctuation">.</span>className<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">'min-h-[44px]'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Focus Ring Location'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token string">'focus ring is on Layer 1 (AriaButton), not Layer 2'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token function">render</span><span class="token punctuation">(</span><span class="token operator">&lt;</span>Button<span class="token operator">></span>Test<span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">></span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> button <span class="token operator">=</span> screen<span class="token punctuation">.</span><span class="token function">getByRole</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> visualLayer <span class="token operator">=</span> button<span class="token punctuation">.</span><span class="token function">querySelector</span><span class="token punctuation">(</span><span class="token string">'span'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

      <span class="token comment">// Focus ring on button</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>button<span class="token punctuation">.</span>className<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">'focus-visible:ring-2'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token comment">// NOT on visual layer</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>visualLayer<span class="token operator">?.</span>className<span class="token punctuation">)</span><span class="token punctuation">.</span>not<span class="token punctuation">.</span><span class="token function">toContain</span><span class="token punctuation">(</span><span class="token string">'focus-visible:ring'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>`),n(H);var U=t(H,4),Ls=s(U);a(Ls,()=>`<code class="language-typescript"><span class="token comment">// Verify visual appearance at different sizes</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'button visual sizes'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> page <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'/storybook?id=button--all-sizes'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token comment">// Screenshot each variant</span>
  <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">locator</span><span class="token punctuation">(</span><span class="token string">'.button-sm'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveScreenshot</span><span class="token punctuation">(</span><span class="token string">'button-sm.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">locator</span><span class="token punctuation">(</span><span class="token string">'.button-default'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveScreenshot</span><span class="token punctuation">(</span><span class="token string">'button-default.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">locator</span><span class="token punctuation">(</span><span class="token string">'.button-lg'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveScreenshot</span><span class="token punctuation">(</span><span class="token string">'button-lg.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">await</span> <span class="token function">expect</span><span class="token punctuation">(</span>page<span class="token punctuation">.</span><span class="token function">locator</span><span class="token punctuation">(</span><span class="token string">'.button-dot'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveScreenshot</span><span class="token punctuation">(</span><span class="token string">'button-dot.png'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment">// Verify touch target is 44px regardless of visual</span>
<span class="token function">test</span><span class="token punctuation">(</span><span class="token string">'touch targets meet WCAG AAA'</span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">&#123;</span> page <span class="token punctuation">&#125;</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">await</span> page<span class="token punctuation">.</span><span class="token function">goto</span><span class="token punctuation">(</span><span class="token string">'/storybook?id=button--dot-size'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">const</span> button <span class="token operator">=</span> page<span class="token punctuation">.</span><span class="token function">locator</span><span class="token punctuation">(</span><span class="token string">'button'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token keyword">const</span> box <span class="token operator">=</span> <span class="token keyword">await</span> button<span class="token punctuation">.</span><span class="token function">boundingBox</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token function">expect</span><span class="token punctuation">(</span>box<span class="token operator">?.</span>width<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeGreaterThanOrEqual</span><span class="token punctuation">(</span><span class="token number">44</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token function">expect</span><span class="token punctuation">(</span>box<span class="token operator">?.</span>height<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toBeGreaterThanOrEqual</span><span class="token punctuation">(</span><span class="token number">44</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>`),n(U);var V=t(U,4),Es=s(V);a(Es,()=>`<code class="language-typescript"><span class="token keyword">import</span> <span class="token punctuation">&#123;</span> axe<span class="token punctuation">,</span> toHaveNoViolations <span class="token punctuation">&#125;</span> <span class="token keyword">from</span> <span class="token string">'jest-axe'</span><span class="token punctuation">;</span>
expect<span class="token punctuation">.</span><span class="token function">extend</span><span class="token punctuation">(</span>toHaveNoViolations<span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token function">describe</span><span class="token punctuation">(</span><span class="token string">'Accessibility'</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
  <span class="token keyword">const</span> visualSizes <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'sm'</span><span class="token punctuation">,</span> <span class="token string">'default'</span><span class="token punctuation">,</span> <span class="token string">'lg'</span><span class="token punctuation">,</span> <span class="token string">'icon'</span><span class="token punctuation">,</span> <span class="token string">'dot'</span><span class="token punctuation">]</span> <span class="token keyword">as</span> <span class="token keyword">const</span><span class="token punctuation">;</span>

  visualSizes<span class="token punctuation">.</span><span class="token function">forEach</span><span class="token punctuation">(</span><span class="token punctuation">(</span>visualSize<span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
    <span class="token function">it</span><span class="token punctuation">(</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token string">has no axe violations for visualSize="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>visualSize<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string">"</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">,</span> <span class="token keyword">async</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=></span> <span class="token punctuation">&#123;</span>
      <span class="token keyword">const</span> <span class="token punctuation">&#123;</span> container <span class="token punctuation">&#125;</span> <span class="token operator">=</span> <span class="token function">render</span><span class="token punctuation">(</span>
        <span class="token operator">&lt;</span>Button
          visualSize<span class="token operator">=</span><span class="token punctuation">&#123;</span>visualSize<span class="token punctuation">&#125;</span>
          aria<span class="token operator">-</span>label<span class="token operator">=</span><span class="token punctuation">&#123;</span><span class="token template-string"><span class="token template-punctuation string">&#96;</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">$&#123;</span>visualSize<span class="token interpolation-punctuation punctuation">&#125;</span></span><span class="token string"> button</span><span class="token template-punctuation string">&#96;</span></span><span class="token punctuation">&#125;</span>
        <span class="token operator">></span>
          <span class="token punctuation">&#123;</span>visualSize <span class="token operator">!==</span> <span class="token string">'dot'</span> <span class="token operator">&amp;&amp;</span> visualSize <span class="token operator">!==</span> <span class="token string">'icon'</span> <span class="token operator">?</span> <span class="token string">'Text'</span> <span class="token operator">:</span> <span class="token keyword">undefined</span><span class="token punctuation">&#125;</span>
        <span class="token operator">&lt;</span><span class="token operator">/</span>Button<span class="token operator">></span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token keyword">const</span> results <span class="token operator">=</span> <span class="token keyword">await</span> <span class="token function">axe</span><span class="token punctuation">(</span>container<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">expect</span><span class="token punctuation">(</span>results<span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">toHaveNoViolations</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code>`),n(V);var $=t(V,10),Ps=s($);a(Ps,()=>`<code class="language-undefined">The Gap Challenge Illustrated
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Traditional 32px buttons with 8px gap:

┌────────────────┐ 8px ┌────────────────┐
│     Button     │◄───►│     Button     │
└────────────────┘     └────────────────┘
        32px                  32px

Three-Layer with 32px visual, 44px touch, 8px gap:

┌───────────────────────────┐ 8px ┌───────────────────────────┐
│                           │◄───►│                           │
│   ┌────────────────┐      │     │      ┌────────────────┐   │
│   │     Button     │      │     │      │     Button     │   │
│   └────────────────┘      │     │      └────────────────┘   │
│                           │     │                           │
└───────────────────────────┘     └───────────────────────────┘
          44px                              44px

Visual gap appears to be: 8px + 6px + 6px = 20px
(44-32)/2 = 6px of transparent space on each side</code>`),n($);var Y=t($,10),Ds=s(Y);a(Ds,()=>`<code class="language-tsx"><span class="token comment">// ❌ BAD - DO NOT DO THIS</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>flex<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token punctuation">&#123;</span><span class="token comment">/* Touch targets overlap, z-index determines winner */</span><span class="token punctuation">&#125;</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>z-10<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Previous</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>z-20<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">1</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>z-30<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">2</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">></span></span><span class="token plain-text">  </span><span class="token punctuation">&#123;</span><span class="token comment">/* Steals adjacent touch areas */</span><span class="token punctuation">&#125;</span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>z-20<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">3</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span><span class="token class-name">Button</span></span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>z-10<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token plain-text">Next</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span><span class="token class-name">Button</span></span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code>`),n(Y);var K=t(Y,2),Ns=s(K);a(Ns,()=>`<code class="language-undefined">Why Overlapping Touch Targets FAIL Users
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Visual appearance (what users see):

┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐ ┌──────┐
│  &lt;   │ │  1   │ │  2   │ │  3   │ │  &gt;   │
└──────┘ └──────┘ └──────┘ └──────┘ └──────┘

What ACTUALLY happens when a motor-impaired user taps:

┌──────────────────────────────────────────────────────────────────────┐
│  User aims │ User aims │ User aims │ User aims │ User aims           │
│  for &quot;&lt;&quot;   │ for &quot;1&quot;   │ for &quot;2&quot;   │ for &quot;3&quot;   │ for &quot;&gt;&quot;             │
│     ↓      │     ↓     │     ↓     │     ↓     │     ↓               │
│  Gets &quot;1&quot;! │ Gets &quot;2&quot;! │ Gets &quot;2&quot;  │ Gets &quot;2&quot;! │ Gets &quot;3&quot;!           │
│  (WRONG)   │ (WRONG)   │ (correct) │ (WRONG)   │ (WRONG)             │
└──────────────────────────────────────────────────────────────────────┘

Higher z-index elements STEAL touches intended for adjacent elements.</code>`),n(K);var J=t(K,8),Ms=s(J);a(Ms,()=>`<code class="language-css"><span class="token comment">/* ❌ BAD - DO NOT DO THIS */</span>
<span class="token selector">.button-group .button-layer-1</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">/* Pull adjacent touch targets closer */</span>
  <span class="token property">margin-left</span><span class="token punctuation">:</span> -6px<span class="token punctuation">;</span>
  <span class="token property">margin-right</span><span class="token punctuation">:</span> -6px<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code>`),n(J);var X=t(J,16),Os=s(X);a(Os,()=>`<code class="language-tsx"><span class="token comment">// ❌ BAD - DO NOT DO THIS</span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>div</span>
  <span class="token attr-name">role</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>group<span class="token punctuation">"</span></span>
  <span class="token attr-name">aria-label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Quantity<span class="token punctuation">"</span></span>
  <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>inline-flex min-h-[44px] items-center border rounded-md<span class="token punctuation">"</span></span>
<span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
    <span class="token attr-name">aria-label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Decrease quantity<span class="token punctuation">"</span></span>
    <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>h-8 w-8 flex items-center justify-center<span class="token punctuation">"</span></span>  <span class="token comment">// Too small!</span>
  <span class="token punctuation">></span></span><span class="token plain-text">
    -
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>span</span> <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>w-12 text-center<span class="token punctuation">"</span></span><span class="token punctuation">></span></span><span class="token punctuation">&#123;</span>quantity<span class="token punctuation">&#125;</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>span</span><span class="token punctuation">></span></span><span class="token plain-text">
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>button</span>
    <span class="token attr-name">aria-label</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>Increase quantity<span class="token punctuation">"</span></span>
    <span class="token attr-name">className</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">"</span>h-8 w-8 flex items-center justify-center<span class="token punctuation">"</span></span>  <span class="token comment">// Too small!</span>
  <span class="token punctuation">></span></span><span class="token plain-text">
    +
  </span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>button</span><span class="token punctuation">></span></span><span class="token plain-text">
</span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>div</span><span class="token punctuation">></span></span></code>`),n(X);var Z=t(X,16),Fs=s(Z);a(Fs,()=>`<code class="language-css"><span class="token comment">/* ❌ BAD - DO NOT DO THIS */</span>
<span class="token comment">/* Base: Mobile-first, large touch targets */</span>
<span class="token selector">.button-layer-1</span> <span class="token punctuation">&#123;</span>
  <span class="token property">min-height</span><span class="token punctuation">:</span> 44px<span class="token punctuation">;</span>
  <span class="token property">min-width</span><span class="token punctuation">:</span> 44px<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token comment">/* "Enhancement": Smaller for precise pointers */</span>
<span class="token atrule"><span class="token rule">@media</span> <span class="token punctuation">(</span><span class="token property">pointer</span><span class="token punctuation">:</span> fine<span class="token punctuation">)</span> <span class="token keyword">and</span> <span class="token punctuation">(</span><span class="token property">hover</span><span class="token punctuation">:</span> hover<span class="token punctuation">)</span></span> <span class="token punctuation">&#123;</span>
  <span class="token selector">.button-layer-1--responsive</span> <span class="token punctuation">&#123;</span>
    <span class="token property">min-height</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>  <span class="token comment">/* Assumes precision = ability */</span>
    <span class="token property">min-width</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>
  <span class="token punctuation">&#125;</span>
<span class="token punctuation">&#125;</span></code>`),n(Z);var Q=t(Z,14),zs=s(Q);a(zs,()=>`<code class="language-css"><span class="token comment">/* Grid cells sized to touch target */</span>
<span class="token selector">.toolbar-grid</span> <span class="token punctuation">&#123;</span>
  <span class="token property">display</span><span class="token punctuation">:</span> grid<span class="token punctuation">;</span>
  <span class="token property">grid-template-columns</span><span class="token punctuation">:</span> <span class="token function">repeat</span><span class="token punctuation">(</span>auto-fit<span class="token punctuation">,</span> 44px<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">gap</span><span class="token punctuation">:</span> 0<span class="token punctuation">;</span>  <span class="token comment">/* Touch targets are adjacent */</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">.toolbar-button-visual</span> <span class="token punctuation">&#123;</span>
  <span class="token comment">/* Visual centered in 44px cell */</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 32px<span class="token punctuation">;</span>
  <span class="token property">margin</span><span class="token punctuation">:</span> auto<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span></code>`),n(Q);var ss=t(Q,2),js=s(ss);a(js,()=>`<code class="language-undefined">Grid-Aware Layout
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Grid cells (44px each, no gap):

┌────────────┬────────────┬────────────┬────────────┐
│            │            │            │            │
│   ┌────┐   │   ┌────┐   │   ┌────┐   │   ┌────┐   │
│   │Icon│   │   │Icon│   │   │Icon│   │   │Icon│   │
│   └────┘   │   └────┘   │   └────┘   │   └────┘   │
│            │            │            │            │
└────────────┴────────────┴────────────┴────────────┘
    44px         44px         44px         44px

Visuals (32px) appear to have 12px gaps.
Touch targets (44px) are adjacent with no gaps.</code>`),n(ss);var ns=t(ss,32),qs=s(ns);a(qs,()=>`<code class="language-undefined">React Aria&#39;s Three-Part Architecture
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│  STATE HOOK            BEHAVIOUR HOOK           RENDERED COMPONENT      │
│  (useButtonState)      (useButton)              (&lt;Button&gt;)              │
│                                                                         │
│  ┌─────────────┐      ┌─────────────────┐      ┌─────────────────────┐  │
│  │ Core logic  │      │ Event handling  │      │ DOM structure       │  │
│  │ Platform-   │ ───► │ Accessibility   │ ───► │ Styling             │  │
│  │ independent │      │ i18n            │      │ Composition         │  │
│  └─────────────┘      └─────────────────┘      └─────────────────────┘  │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code>`),n(ns);var ts=t(ns,10),Gs=s(ts);a(Gs,()=>`<code class="language-undefined">Headless Library Separation
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

┌─────────────────────────────────────────────────────────────────────────┐
│                                                                         │
│        HEADLESS LIBRARY                    DEVELOPER STYLING            │
│                                                                         │
│  ┌─────────────────────────────┐      ┌─────────────────────────────┐  │
│  │ Focus management            │      │ Colours                     │  │
│  │ Keyboard navigation         │      │ Borders                     │  │
│  │ ARIA attributes             │      │ Shadows                     │  │
│  │ Screen reader support       │ ───► │ Typography                  │  │
│  │ Portal rendering            │      │ Animations                  │  │
│  │ Click outside detection     │      │ Size (!!!)                  │  │
│  └─────────────────────────────┘      └─────────────────────────────┘  │
│                                                                         │
│  Note: Size is developer&#39;s responsibility!                              │
│                                                                         │
└─────────────────────────────────────────────────────────────────────────┘</code>`),n(ts);var as=t(ts,8),Hs=s(as);a(Hs,()=>`<code class="language-vue">&lt;!-- Renderless toggle providing only behaviour --&gt;
&lt;Toggle v-slot=&quot;&#123; isOn, toggle &#125;&quot;&gt;
  &lt;!-- Developer provides all visuals --&gt;
  &lt;button @click=&quot;toggle&quot; :class=&quot;isOn ? &#39;bg-green-500&#39; : &#39;bg-gray-200&#39;&quot;&gt;
    &#123;&#123; isOn ? &#39;On&#39; : &#39;Off&#39; &#125;&#125;
  &lt;/button&gt;
&lt;/Toggle&gt;</code>`),n(as);var es=t(as,18),Us=s(es);a(Us,()=>`<code class="language-css"><span class="token selector">.small-icon-button</span> <span class="token punctuation">&#123;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> relative<span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 24px<span class="token punctuation">;</span>
<span class="token punctuation">&#125;</span>

<span class="token selector">.small-icon-button::before</span> <span class="token punctuation">&#123;</span>
  <span class="token property">content</span><span class="token punctuation">:</span> <span class="token string">''</span><span class="token punctuation">;</span>
  <span class="token property">position</span><span class="token punctuation">:</span> absolute<span class="token punctuation">;</span>
  <span class="token property">top</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
  <span class="token property">left</span><span class="token punctuation">:</span> 50%<span class="token punctuation">;</span>
  <span class="token property">transform</span><span class="token punctuation">:</span> <span class="token function">translate</span><span class="token punctuation">(</span>-50%<span class="token punctuation">,</span> -50%<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token property">width</span><span class="token punctuation">:</span> 44px<span class="token punctuation">;</span>
  <span class="token property">height</span><span class="token punctuation">:</span> 44px<span class="token punctuation">;</span>
  <span class="token comment">/* Invisible but clickable */</span>
<span class="token punctuation">&#125;</span></code>`),n(es);var ps=t(es,32),Vs=s(ps);a(Vs,()=>`<code class="language-undefined">The Old Paradigm (Rejected)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

            Accessibility ◄────────── CHOOSE ──────────► Aesthetics


The New Paradigm (Three-Layer Architecture)
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

                    ┌──────────────────────────┐
                    │                          │
                    │   Accessibility (L1)     │
                    │         AND              │
                    │   Aesthetics (L2)        │
                    │         AND              │
                    │   Content (L3)           │
                    │                          │
                    └──────────────────────────┘

                    Different concerns.
                    Different layers.
                    Both excellent.</code>`),n(ps),w(112),h(p,e)}const Cn=Object.freeze(Object.defineProperty({__proto__:null,default:In,metadata:ys},Symbol.toStringTag,{value:"Module"})),Wn=(p,e,o)=>{const r=p[e];return r?typeof r=="function"?r():Promise.resolve(r):new Promise((i,l)=>{(typeof queueMicrotask=="function"?queueMicrotask:setTimeout)(l.bind(null,new Error("Unknown variable dynamic import: "+e+(e.split("/").length!==o?". Note that variables only represent file names one level deep.":""))))})};async function Rn(p){try{const e=await Wn(Object.assign({"../../content/blog/FR-0000-why-we-are-writing-this.md":()=>f(()=>Promise.resolve().then(()=>an),void 0,import.meta.url),"../../content/blog/FR-0001-the-multizone-gambit.md":()=>f(()=>Promise.resolve().then(()=>pn),void 0,import.meta.url),"../../content/blog/FR-0002-why-react-aria-won.md":()=>f(()=>Promise.resolve().then(()=>ln),void 0,import.meta.url),"../../content/blog/FR-0003-the-44px-illusion.md":()=>f(()=>Promise.resolve().then(()=>hn),void 0,import.meta.url),"../../content/blog/FR-0004-the-compliance-trap.md":()=>f(()=>Promise.resolve().then(()=>mn),void 0,import.meta.url),"../../content/blog/FR-0005-the-server-side-shield.md":()=>f(()=>Promise.resolve().then(()=>fn),void 0,import.meta.url),"../../content/blog/FR-0006-the-observability-iceberg.md":()=>f(()=>Promise.resolve().then(()=>Tn),void 0,import.meta.url),"../../content/blog/FR-0022-one-doc-site-to-rule-them-all.md":()=>f(()=>Promise.resolve().then(()=>_n),void 0,import.meta.url),"../../content/blog/WP-001-three-layer-component-architecture.md":()=>f(()=>Promise.resolve().then(()=>Cn),void 0,import.meta.url)}),`../../content/blog/${p}.md`,5);return{content:e.default,metadata:e.metadata}}catch{return null}}function Bn(p){return new Date(p).toLocaleDateString("en-GB",{year:"numeric",month:"long",day:"numeric"})}function Ln(p,e){throw new Qs(p,e)}const En=async({params:p})=>{const e=await Rn(p.slug);if(!e)throw Ln(404,"Post not found");return{content:e.content,...e.metadata}},Ga=Object.freeze(Object.defineProperty({__proto__:null,load:En},Symbol.toStringTag,{value:"Module"}));var Pn=g('<span class="label"> </span>'),Dn=g('<span class="text-border">|</span> <!>',1),Nn=g('<!> <article class="mx-auto max-w-3xl px-6 py-16 md:py-24"><header class="mb-16"><a href="/blog" class="label mb-8 inline-flex min-h-[44px] items-center gap-2 transition-transform hover:opacity-60"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="m12 19-7-7 7-7"></path><path d="M19 12H5"></path></svg> Back to blog</a> <h1 class="mb-6"> </h1> <div class="flex flex-wrap items-center gap-3"><time class="label"> </time> <!></div></header> <div class="prose"><!></div></article>',1);function Ha(p,e){Ks(e,!0);var o=Nn(),r=b(o);sn(r,{get title(){return`${e.data.title??""} | Mark Basford`},get description(){return e.data.description},type:"article",get publishedTime(){return e.data.date},get tags(){return e.data.tags}});var i=t(r,2),l=s(i),c=t(s(l),2),m=s(c,!0);n(c);var u=t(c,2),y=s(u),k=s(y,!0);n(y);var T=t(y,2);{var v=d=>{var A=Dn(),x=t(b(A),2);Zs(x,16,()=>e.data.tags,_=>_,(_,S)=>{var W=Pn(),R=s(W,!0);n(W),rs(()=>os(R,S)),h(_,W)}),h(d,A)};is(T,d=>{e.data.tags&&e.data.tags.length>0&&d(v)})}n(u),n(l);var I=t(l,2),C=s(I);{var B=d=>{var A=Ys(),x=b(A);$s(x,()=>e.data.content,(_,S)=>{S(_,{})}),h(d,A)};is(C,d=>{e.data.content&&d(B)})}n(I),n(i),rs(d=>{os(m,e.data.title),Xs(y,"datetime",e.data.date),os(k,d)},[()=>Bn(e.data.date)]),h(p,o),Js()}export{Ha as component,Ga as universal};
